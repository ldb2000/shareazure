<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShareAzure - Mon espace de stockage</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="css/user.css?v=20260220g">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="user-header">
        <div class="header-container">
            <div class="header-left">
                <img src="img/company-logo.svg" alt="" class="header-logo company-logo-img" onerror="this.style.display='none'">
                <h1 class="header-title app-title">Mon espace de stockage</h1>
            </div>
            <div class="header-right">
                <button class="btn-icon" id="shareLinksBtn" title="Mes liens de partage">
                    <i class="fas fa-link"></i>
                </button>
                <button class="btn-icon" id="discoverBtn" title="Decouvrir">
                    <i class="fas fa-compass"></i>
                </button>
                <div style="position:relative;display:inline-block;">
                    <button class="btn-icon" id="guestsBtn" title="Invit√©s">
                        <i class="fas fa-users"></i>
                    </button>
                    <div id="guestsDropdown" style="display:none;position:absolute;top:100%;right:0;background:#fff;border-radius:10px;box-shadow:0 4px 20px rgba(0,0,0,0.15);z-index:1000;min-width:200px;overflow:hidden;">
                        <button onclick="showCreateGuestModal();document.getElementById('guestsDropdown').style.display='none';" style="display:block;width:100%;padding:12px 16px;border:none;background:none;text-align:left;cursor:pointer;font-size:0.9rem;color:#333;border-bottom:1px solid #eee;" onmouseover="this.style.background='#f5f5f5'" onmouseout="this.style.background='none'">
                            <i class="fas fa-user-plus" style="color:#0066cc;width:20px;"></i> Cr√©er un invit√©
                        </button>
                        <button onclick="showMyGuestsModal();document.getElementById('guestsDropdown').style.display='none';" style="display:block;width:100%;padding:12px 16px;border:none;background:none;text-align:left;cursor:pointer;font-size:0.9rem;color:#333;" onmouseover="this.style.background='#f5f5f5'" onmouseout="this.style.background='none'">
                            <i class="fas fa-list" style="color:#4caf50;width:20px;"></i> Mes invit√©s
                        </button>
                    </div>
                </div>
                <button class="btn-icon" id="finopsBtn" title="Mes co√ªts" onclick="showFinopsSection()">
                    <i class="fas fa-chart-line"></i>
                </button>
                <button class="btn-icon" id="trashBtn" title="Corbeille" onclick="showTrashModal()">
                    <i class="fas fa-trash-alt"></i>
                </button>
                <button class="btn-icon" id="createFolderBtn" title="Cr√©er un dossier">
                    <i class="fas fa-folder-plus"></i>
                </button>
                <button class="btn-icon" id="uploadBtn" title="Uploader un fichier">
                    <i class="fas fa-cloud-upload-alt"></i>
                </button>
                <button class="btn-icon" id="teamMembersBtn" title="Membres de l'√©quipe" style="display:none;" onclick="showTeamMembersModal()">
                    <i class="fas fa-users"></i>
                </button>
                <button class="btn-icon" id="teamSettingsBtn" title="Param√®tres √©quipe" style="display:none;" onclick="showTeamSettingsModal()">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="btn-icon" id="refreshBtn" title="Actualiser">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <div class="notif-wrapper" style="position:relative;display:inline-block;">
                    <button class="btn-icon" id="notifBtn" title="Notifications" onclick="toggleNotifPanel()">
                        <i class="fas fa-bell"></i>
                        <span class="notif-badge" id="notifBadge" style="display:none;"></span>
                    </button>
                    <div class="notif-panel" id="notifPanel" style="display:none;">
                        <div class="notif-header">
                            <span>üîî Notifications</span>
                            <button class="btn-link" onclick="markAllRead()">Tout lire</button>
                        </div>
                        <div class="notif-list" id="notifList"></div>
                    </div>
                </div>
                <div class="user-menu" style="position:relative;">
                    <span class="user-name" id="userName" style="cursor:pointer;" onclick="document.getElementById('userMenuDropdown').style.display=document.getElementById('userMenuDropdown').style.display==='none'?'block':'none';">Utilisateur ‚ñæ</span>
                    <div id="userMenuDropdown" style="display:none;position:absolute;top:calc(100% + 6px);right:0;background:#fff;border:1px solid #e5e9f0;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.18);min-width:230px;z-index:200;overflow:hidden;">
                        <div style="padding:14px 16px;border-bottom:1px solid #f0f2f5;background:#f8fafc;">
                            <div style="font-weight:600;color:#0A2540;font-size:0.9rem;" id="dropdownUserName"></div>
                            <div style="font-size:0.75rem;color:#5F6B7A;margin-top:2px;" id="dropdownUserRole"></div>
                        </div>
                        <button onclick="showChangePasswordModal();document.getElementById('userMenuDropdown').style.display='none';" style="display:flex;align-items:center;gap:10px;width:100%;padding:12px 16px;border:none;background:none;cursor:pointer;font-size:0.85rem;color:#1A1A2E;transition:background 0.15s;" onmouseover="this.style.background='#f5f7fa'" onmouseout="this.style.background='none'">
                            <i class="fas fa-key" style="color:#1a73e8;width:18px;text-align:center;"></i> Changer le mot de passe
                        </button>
                        <div style="height:1px;background:#f0f2f5;margin:0 12px;"></div>
                        <button onclick="document.getElementById('logoutBtn').click();document.getElementById('userMenuDropdown').style.display='none';" style="display:flex;align-items:center;gap:10px;width:100%;padding:12px 16px;border:none;background:none;cursor:pointer;font-size:0.85rem;color:#DC2626;transition:background 0.15s;" onmouseover="this.style.background='#fef2f2'" onmouseout="this.style.background='none'">
                            <i class="fas fa-sign-out-alt" style="width:18px;text-align:center;"></i> Se d√©connecter
                        </button>
                    </div>
                    <button class="btn-icon" id="logoutBtn" title="D√©connexion" style="display:none;">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="user-main">
        <!-- Context Tabs (Mes fichiers / √âquipes) -->
                <div class="context-tabs" id="contextTabs" style="display:none;">
            <div class="context-tabs-group">
                
                <button class="context-tab active" data-context="my" id="ctxTabMy">
                    <i class="fas fa-folder"></i> Mes fichiers
                </button>
            </div>
            <div class="context-separator"></div>
            <div class="context-tabs-group" id="teamTabsGroup" style="display:none;">
                <span class="context-label">Mes √©quipes</span>
                <div class="context-tabs-list" id="teamTabsList"></div>
                <button class="context-tab" id="createTeamBtn" title="Cr√©er une √©quipe" onclick="showCreateTeamModal()" style="min-width:36px;padding:6px 10px;font-size:1.1rem;color:#639E30;">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            <div class="team-actions" id="teamActions" style="display:none;">
                <button class="btn-team-action" id="teamMembersBtn2" title="G√©rer les membres" onclick="showTeamMembersModal()">
                    <i class="fas fa-users-gear"></i> Membres
                </button>
                <button class="btn-team-action" id="teamSettingsBtn" title="Param√®tres de l'√©quipe" style="display:none;">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>

        <!-- Toolbar -->
        <div class="toolbar">
            <div class="toolbar-left">
                <button class="btn-view active" data-view="grid" title="Vue grille">
                    <i class="fas fa-th-large"></i>
                </button>
                <button class="btn-view" data-view="grid-compact" title="Vue grille compacte">
                    <i class="fas fa-th"></i>
                </button>
                <button class="btn-view" data-view="list" title="Vue liste">
                    <i class="fas fa-list"></i>
                </button>
                <div class="view-separator"></div>
                <button class="btn-filter" id="filterBtn" title="Filtrer">
                    <i class="fas fa-filter"></i>
                    <span>Filtrer</span>
                </button>
            </div>
            <div class="toolbar-right">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Rechercher par nom ou tag...">
                </div>
            </div>
        </div>

        <!-- Filter Panel -->
        <div class="filter-panel" id="filterPanel" style="display: none;">
            <div class="filter-group">
                <label>Type de fichier</label>
                <select id="typeFilter" class="filter-select">
                    <option value="">Tous les types</option>
                    <option value="image">Images</option>
                    <option value="video">Vid√©os</option>
                    <option value="audio">Audio</option>
                    <option value="document">Documents</option>
                    <option value="other">Autres</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Trier par</label>
                <select id="sortFilter" class="filter-select">
                    <option value="date-desc">Plus r√©cent</option>
                    <option value="date-asc">Plus ancien</option>
                    <option value="name-asc">Nom (A-Z)</option>
                    <option value="name-desc">Nom (Z-A)</option>
                    <option value="size-desc">Plus volumineux</option>
                    <option value="size-asc">Plus l√©ger</option>
                </select>
            </div>
            <button class="btn btn-secondary" id="clearFiltersBtn">R√©initialiser</button>
        </div>

        <!-- Breadcrumb -->
        <div class="breadcrumb" id="breadcrumb">
            <button class="breadcrumb-item active" data-path="">
                <i class="fas fa-home"></i>
                <span>Accueil</span>
            </button>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Share Links Section -->
            <div class="share-links-section" id="shareLinksSection" style="display: none;">
                <div class="section-header">
                    <h2>Mes liens de partage</h2>
                    <div style="display:flex;gap:8px;align-items:center;">
                        <button class="btn btn-danger" id="deleteExpiredLinksBtn" style="display:none;font-size:0.85rem;padding:8px 14px;background:#DC2626;color:#fff;border:none;border-radius:8px;cursor:pointer;" title="Supprimer tous les liens expir√©s">
                            <i class="fas fa-trash"></i> Supprimer les expir√©s
                        </button>
                        <button class="btn btn-secondary" id="closeShareLinksBtn">
                            <i class="fas fa-times"></i>
                            Fermer
                        </button>
                    </div>
                </div>
                <div class="share-links-container" id="shareLinksContainer">
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p>Chargement de vos liens de partage...</p>
                    </div>
                </div>
            </div>

            <!-- Team Files Section (read-only for team members) -->
            <!-- Discover Section -->
            <div class="discover-section" id="discoverSection" style="display: none;">
                <div class="section-header">
                    <h2><i class="fas fa-compass"></i> Decouvrir</h2>
                    <button class="btn btn-secondary" id="closeDiscoverBtn">
                        <i class="fas fa-times"></i>
                        Fermer
                    </button>
                </div>
                <div class="discover-tabs">
                    <button class="discover-tab active" data-tab="tags">
                        <i class="fas fa-tags"></i> Par Tags
                    </button>
                    <button class="discover-tab" data-tab="search">
                        <i class="fas fa-brain"></i> Recherche IA
                    </button>
                    <button class="discover-tab" data-tab="map">
                        <i class="fas fa-map-marked-alt"></i> Carte
                    </button>
                </div>

                <!-- Tab: Tags -->
                <div class="discover-tab-content" id="discoverTabTags">
                    <div class="discover-tag-cloud" id="discoverTagCloud">
                        <div class="loading-state">
                            <div class="spinner"></div>
                            <p>Chargement des tags...</p>
                        </div>
                    </div>
                    <div class="discover-tag-results" id="discoverTagResults" style="display: none;">
                        <button class="btn btn-secondary btn-sm" id="discoverBackToTags">
                            <i class="fas fa-arrow-left"></i> Retour aux tags
                        </button>
                        <h3 id="discoverTagResultsTitle" style="margin: 1rem 0;"></h3>
                        <div class="discover-results-grid" id="discoverTagFilesGrid"></div>
                    </div>
                </div>

                <!-- Tab: Search -->
                <div class="discover-tab-content" id="discoverTabSearch" style="display: none;">
                    <div class="discover-search-bar">
                        <div class="discover-search-input-wrapper">
                            <i class="fas fa-search"></i>
                            <input type="text" id="discoverSearchInput" placeholder="Rechercher par description, tags, contenu...">
                            <div class="discover-suggestions" id="discoverSuggestions" style="display: none;"></div>
                        </div>
                        <select id="discoverSearchType" class="filter-select">
                            <option value="">Tous les types</option>
                            <option value="image">Images</option>
                            <option value="video">Videos</option>
                            <option value="audio">Audio</option>
                            <option value="document">Documents</option>
                        </select>
                        <button class="btn btn-primary" id="discoverSearchBtn">
                            <i class="fas fa-search"></i> Rechercher
                        </button>
                    </div>
                    <div class="discover-results-grid" id="discoverSearchResultsGrid"></div>
                </div>

                <!-- Tab: Map -->
                <div class="discover-tab-content" id="discoverTabMap" style="display: none;">
                    <div id="discover-map"></div>
                    <p class="discover-map-counter" id="discoverMapCounter"></p>
                </div>
            </div>

            <!-- FinOps Section -->
            <div class="finops-section" id="finopsSection" style="display: none;">
                <div class="section-header">
                    <h2>üìä Mes Co√ªts &amp; Optimisations</h2>
                    <button class="btn btn-secondary" id="closeFinopsBtn" onclick="hideFinopsSection()">
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                </div>

                <!-- Summary Cards -->
                <div class="finops-cards" id="finopsSummaryCards">
                    <div class="finops-card">
                        <div class="finops-card-icon" style="background:#e3f2fd;color:#1565c0;"><i class="fas fa-database"></i></div>
                        <div class="finops-card-label">Stockage mensuel</div>
                        <div class="finops-card-value" id="finopsTotalStorage">-</div>
                        <div class="finops-card-sub" id="finopsTotalSize">-</div>
                    </div>
                    <div class="finops-card">
                        <div class="finops-card-icon" style="background:#e8f5e9;color:#2e7d32;"><i class="fas fa-share-alt"></i></div>
                        <div class="finops-card-label">Partages (egress)</div>
                        <div class="finops-card-value" id="finopsShareCost">-</div>
                        <div class="finops-card-sub" id="finopsShareInfo">-</div>
                    </div>
                    <div class="finops-card">
                        <div class="finops-card-icon" style="background:#fff3e0;color:#e65100;"><i class="fas fa-user-friends"></i></div>
                        <div class="finops-card-label">Fichiers invit√©s</div>
                        <div class="finops-card-value" id="finopsGuestCost">-</div>
                        <div class="finops-card-sub" id="finopsGuestInfo">-</div>
                    </div>
                    <div class="finops-card finops-card-total">
                        <div class="finops-card-icon" style="background:#fce4ec;color:#c62828;"><i class="fas fa-euro-sign"></i></div>
                        <div class="finops-card-label">Co√ªt total / mois</div>
                        <div class="finops-card-value" id="finopsTotalCost">-</div>
                        <div class="finops-card-sub finops-saving" id="finopsPotentialSaving" style="display:none;">
                            <i class="fas fa-leaf"></i> <span></span> d'√©conomie possible
                        </div>
                    </div>
                </div>

                <!-- Tier Breakdown -->
                <div class="finops-tier-section">
                    <h3>R√©partition par niveau de stockage</h3>
                    <div class="finops-tier-bar" id="finopsTierBar"></div>
                    <div class="finops-tier-legend" id="finopsTierLegend"></div>
                    <div class="finops-tier-pricing">
                        <small>Tarifs Azure France Central : <strong>Hot</strong> 0,0184 ‚Ç¨/Go ‚Äî <strong>Cool</strong> 0,01 ‚Ç¨/Go ‚Äî <strong>Archive</strong> 0,00099 ‚Ç¨/Go/mois</small>
                    </div>
                </div>

                <!-- Optimizations -->
                <div class="finops-optim-section">
                    <h3><i class="fas fa-lightbulb" style="color:#ffa000;"></i> Suggestions d'optimisation</h3>
                    <p class="finops-optim-desc">Ces fichiers pourraient co√ªter moins cher dans un tier inf√©rieur :</p>
                    <div class="finops-optim-list" id="finopsOptimList">
                        <p class="finops-empty">Chargement...</p>
                    </div>
                </div>
            </div>

            <!-- Files Section -->
            <!-- Bulk Actions Bar -->
            <div class="bulk-bar" id="bulkBar" style="display:none;">
                <div class="bulk-info">
                    <input type="checkbox" id="bulkSelectAll" onchange="toggleSelectAll(this.checked)">
                    <span id="bulkCount">0 s√©lectionn√©(s)</span>
                </div>
                <div class="bulk-actions">
                    <button class="btn btn-sm btn-primary" onclick="bulkDownloadZip()" title="T√©l√©charger en ZIP"><i class="fas fa-file-archive"></i> ZIP</button>
                    <button class="btn btn-sm btn-secondary" onclick="bulkShare()" title="Partager la s√©lection"><i class="fas fa-share-alt"></i> Partager</button>
                    <button class="btn btn-sm btn-danger" onclick="bulkDelete()" title="Supprimer"><i class="fas fa-trash"></i> Supprimer</button>
                    <button class="btn btn-sm" onclick="clearSelection()" title="Annuler"><i class="fas fa-times"></i></button>
                </div>
            </div>

            <div class="files-section" id="filesSection">
            <!-- Grid View -->
            <div class="files-grid" id="filesGrid">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Chargement de vos fichiers...</p>
                </div>
            </div>

            <!-- List View -->
            <div class="files-list" id="filesList" style="display: none;">
                <table class="files-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Taille</th>
                            <th>Type</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="filesTableBody">
                        <tr>
                            <td colspan="5" class="loading">Chargement...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <i class="fas fa-folder-open"></i>
                <h3>Aucun fichier</h3>
                <p>Commencez par uploader vos premiers fichiers</p>
                <button class="btn btn-primary" id="uploadEmptyBtn">
                    <i class="fas fa-cloud-upload-alt"></i>
                    Uploader un fichier
                </button>
            </div>
            </div>
            <!-- End Files Section -->
        </div>
    </main>

    <!-- Upload Modal -->
    <div class="modal-overlay" id="uploadModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Uploader des fichiers</h3>
                <button class="btn-close" id="closeUploadBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="upload-zone" id="uploadZone">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Glissez-d√©posez vos fichiers ici</p>
                    <p class="upload-hint">ou</p>
                    <input type="file" id="fileInput" multiple hidden>
                    <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                        Choisir des fichiers
                    </button>
                    <p class="upload-limit">Taille maximale : 100 Mo par fichier</p>
                </div>
                <div class="upload-progress" id="uploadProgress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <p class="progress-text" id="progressText">0%</p>
                </div>
                <div class="upload-files-list" id="uploadFilesList"></div>
            </div>
        </div>
    </div>

    <!-- Create Folder Modal -->
    <div class="modal-overlay" id="createFolderModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Cr√©er un dossier</h3>
                <button class="btn-close" id="closeCreateFolderBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="folderNameInput">Nom du dossier</label>
                    <input type="text" id="folderNameInput" class="form-input" placeholder="Entrez le nom du dossier" autofocus>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelCreateFolderBtn">Annuler</button>
                    <button class="btn btn-primary" id="confirmCreateFolderBtn">Cr√©er</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu" style="display: none;">
        <button class="context-menu-item" id="contextPreview">
            <i class="fas fa-eye"></i>
            <span>Aper√ßu</span>
        </button>
        <button class="context-menu-item" id="contextRename">
            <i class="fas fa-edit"></i>
            <span>Renommer</span>
        </button>
        <button class="context-menu-item" id="contextMove">
            <i class="fas fa-arrows-alt"></i>
            <span>D√©placer</span>
        </button>
        <button class="context-menu-item" id="contextShare">
            <i class="fas fa-share-alt"></i>
            <span>Partager</span>
        </button>
        <button class="context-menu-item" id="contextInfo">
            <i class="fas fa-info-circle"></i>
            <span>Informations</span>
        </button>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item context-submenu" id="contextTierMenu">
            <i class="fas fa-layer-group"></i>
            <span>Tier de stockage</span>
            <i class="fas fa-chevron-right" style="margin-left:auto;font-size:0.7rem;color:#999;"></i>
            <div class="context-submenu-list" id="contextTierSubmenu">
                <button class="context-menu-item" data-tier="Hot"><i class="fas fa-fire" style="color:#ef4444;"></i> <span>Hot</span></button>
                <button class="context-menu-item" data-tier="Cool"><i class="fas fa-snowflake" style="color:#3b82f6;"></i> <span>Cool</span></button>
                <button class="context-menu-item" data-tier="Archive"><i class="fas fa-archive" style="color:#8b5cf6;"></i> <span>Archive</span></button>
            </div>
        </div>
        <div class="context-menu-divider"></div>
        <button class="context-menu-item context-menu-item-danger" id="contextDelete">
            <i class="fas fa-trash"></i>
            <span>Supprimer</span>
        </button>
    </div>

    <!-- Rename Modal -->
    <div class="modal-overlay" id="renameModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="renameModalTitle">Renommer</h3>
                <button class="btn-close" id="closeRenameBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="renameInput">Nouveau nom</label>
                    <input type="text" id="renameInput" class="form-input" autofocus>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelRenameBtn">Annuler</button>
                    <button class="btn btn-primary" id="confirmRenameBtn">Renommer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Move Modal -->
    <div class="modal-overlay" id="moveModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>D√©placer</h3>
                <button class="btn-close" id="closeMoveBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="moveDestinationSelect">Destination</label>
                    <select id="moveDestinationSelect" class="form-select">
                        <option value="">Racine</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelMoveBtn">Annuler</button>
                    <button class="btn btn-primary" id="confirmMoveBtn">D√©placer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal-overlay" id="shareModal" style="display: none;">
        <div class="modal-content" style="max-width: 520px;">
            <div class="modal-header">
                <h3 id="shareModalTitle">Partager le fichier</h3>
                <button class="btn-close" id="closeShareBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- File info -->
                <div id="shareFileInfo" style="background:#f5f7fa;border-radius:8px;padding:12px;margin-bottom:16px;"></div>

                <!-- Step 1: Config (shown initially) -->
                <div id="shareStepConfig">
                    <div class="form-group">
                        <label>Destinataire(s) <span style="color: red;">*</span></label>
                        <input 
                            type="text" 
                            id="shareRecipientEmailInput" 
                            class="form-input" 
                            placeholder="email1@example.com, email2@example.com"
                            required
                        >
                        <small style="color: #666; font-size: 0.85rem;">S√©parez plusieurs emails par des virgules</small>
                    </div>
                    <div class="form-group">
                        <label>Mot de passe <span style="color: red;">*</span></label>
                        <div style="display:flex;gap:8px;">
                            <input type="password" id="sharePasswordInput" class="form-input" placeholder="Mot de passe obligatoire" required style="flex:1;">
                            <button type="button" class="btn btn-icon" id="togglePasswordVisibility" title="Afficher/masquer" style="min-width:40px;">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Date d'expiration</label>
                        <select id="shareExpirationSelect" class="form-select">
                            <option value="60">1 heure</option>
                            <option value="1440" selected>24 heures</option>
                            <option value="4320">3 jours</option>
                            <option value="10080">7 jours</option>
                            <option value="43200">30 jours</option>
                            <option value="129600">90 jours</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-stamp" style="color:#888;"></i> Filigrane (watermark)</label>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <select id="shareWatermarkSelect" class="form-select" style="flex:1;" onchange="document.getElementById('shareWatermarkCustom').style.display=this.value==='custom'?'block':'none'">
                                <option value="">Aucun</option>
                                <option value="CONFIDENTIEL">CONFIDENTIEL</option>
                                <option value="NE PAS DIFFUSER">NE PAS DIFFUSER</option>
                                <option value="USAGE INTERNE">USAGE INTERNE</option>
                                <option value="custom">Personnalis√©...</option>
                            </select>
                        </div>
                        <input type="text" id="shareWatermarkCustom" class="form-input" placeholder="Texte du filigrane" style="display:none;margin-top:6px;" maxlength="50">
                        <small style="color:#999;">Appliqu√© sur les PDF et images lors du t√©l√©chargement</small>
                    </div>
                    <div class="modal-footer" style="display:flex;gap:8px;justify-content:flex-end;padding-top:16px;border-top:1px solid #eee;">
                        <button class="btn btn-secondary" id="cancelShareBtn">Annuler</button>
                        <button class="btn btn-primary" id="applyShareBtn">
                            <i class="fas fa-link"></i> Cr√©er le lien
                        </button>
                    </div>
                </div>

                <!-- Step 2: Result (shown after link creation) -->
                <div id="shareStepResult" style="display:none;">
                    <div class="form-group">
                        <label>Lien de partage</label>
                        <div style="display: flex; gap: 6px;">
                            <input type="text" id="shareLinkInput" class="form-input" readonly style="flex: 1; font-size: 0.85rem;">
                            <button class="btn btn-icon" id="copyShareLinkBtn" title="Copier le lien" style="min-width:40px;">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <div id="shareExpires" style="color:#555;font-size:0.9rem;margin:8px 0;"></div>
                    <div id="shareLinkId" style="display:none;"></div>
                    <div id="sharePassword" style="display:none;"></div>
                    <div id="shareWarning" style="display:none;"></div>
                    <div id="shareQrCode" style="text-align:center;margin:12px 0;">
                        <img id="qrCodeImage" src="" alt="QR Code" style="max-width:140px;border-radius:8px;border:1px solid #eee;">
                    </div>
                    <div class="modal-footer" style="display:flex;gap:8px;justify-content:flex-end;padding-top:16px;border-top:1px solid #eee;">
                        <button class="btn btn-secondary" id="closeShareResultBtn">Fermer</button>
                        <button class="btn btn-primary" id="sendShareEmailBtn" style="background:#2e7d32;">
                            <i class="fas fa-envelope"></i> Envoyer par email
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Guest Modal -->
    <!-- Modal Cr√©er un invit√© -->
    <div class="modal-overlay" id="createGuestModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Cr√©er un invit√©</h3>
                <button class="btn-close" id="closeCreateGuestBtn"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="guestEmailInput">Email de l'invit√© <span style="color: red;">*</span></label>
                    <input type="email" id="guestEmailInput" class="form-input" placeholder="email@example.com" required>
                    <small style="color: #666; font-size: 0.875rem;">Un code de v√©rification sera envoy√© √† cet email</small>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label for="guestDurationSelect">Dur√©e d'acc√®s</label>
                    <select id="guestDurationSelect" class="form-input" style="padding: 10px; border-radius: 8px;">
                        <option value="3">3 jours</option>
                        <option value="7">7 jours</option>
                        <option value="15" selected>15 jours</option>
                        <option value="30">1 mois</option>
                        <option value="0">‚ôæÔ∏è Illimit√© (soumis √† validation admin)</option>
                    </select>
                </div>
                <div id="guestCreateResult" style="display: none; padding: 12px; border-radius: 8px; margin-top: 15px;"></div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelCreateGuestBtn">Annuler</button>
                    <button class="btn btn-primary" id="confirmCreateGuestBtn">
                        <i class="fas fa-user-plus"></i> Cr√©er le compte
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Mes invit√©s -->
    <div class="modal-overlay" id="myGuestsModal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3><i class="fas fa-list"></i> Mes invit√©s</h3>
                <button class="btn-close" id="closeMyGuestsBtn"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="myGuestsList" style="max-height: 500px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div class="gallery-modal" id="galleryModal" style="display: none;">
        <div class="gallery-header">
            <button class="gallery-close" id="closeGalleryBtn">
                <i class="fas fa-times"></i>
            </button>
            <h3 id="galleryTitle">Galerie photo</h3>
            <div class="gallery-info">
                <span id="galleryCounter">1 / 1</span>
            </div>
        </div>
        <div class="gallery-content">
            <button class="gallery-nav gallery-prev" id="galleryPrevBtn">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="gallery-image-container">
                <img id="galleryImage" src="" alt="">
            </div>
            <button class="gallery-nav gallery-next" id="galleryNextBtn">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        <div class="gallery-thumbnails" id="galleryThumbnails"></div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal-overlay" id="confirmModal" style="display: none;">
        <div class="modal-content" style="max-width: 420px;">
            <div class="modal-header">
                <h3 id="confirmTitle">Confirmer</h3>
                <button class="modal-close" id="confirmCloseBtn">&times;</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <div style="font-size: 48px; color: #F8AA36; margin-bottom: 12px;">&#9888;</div>
                <p id="confirmMessage" style="color: var(--text-secondary); white-space: pre-line;"></p>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="confirmNoBtn">Annuler</button>
                    <button class="btn btn-danger" id="confirmYesBtn">Confirmer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Team Members Modal -->
    <div class="modal-overlay" id="teamMembersModal" style="display:none;">
        <div class="modal-content" style="max-width:650px;">
            <div class="modal-header">
                <h3><i class="fas fa-users"></i> Membres de l'√©quipe</h3>
                <button class="btn-close" onclick="document.getElementById('teamMembersModal').style.display='none'"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="teamMembersAddSection" style="display:none;margin-bottom:16px;">
                    <div style="display:flex;gap:8px;">
                        <input type="text" id="teamMemberUsername" class="form-input" placeholder="Nom d'utilisateur" style="flex:1;">
                        <select id="teamMemberRole" class="form-select" style="width:auto;">
                            <option value="member">Membre</option>
                            <option value="viewer">Lecteur</option>
                        </select>
                        <button class="btn btn-primary" onclick="addTeamMember()"><i class="fas fa-plus"></i></button>
                    </div>
                </div>
                <div id="teamMembersList" style="max-height:400px;overflow-y:auto;"></div>
            </div>
        </div>
    </div>

    <!-- Team Settings Modal -->
    <div class="modal-overlay" id="teamSettingsModal" style="display:none;">
        <div class="modal-content" style="max-width:500px;">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> Param√®tres de l'√©quipe</h3>
                <button class="btn-close" onclick="document.getElementById('teamSettingsModal').style.display='none'"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nom affich√©</label>
                    <input type="text" id="teamSettingsName" class="form-input" placeholder="Nom de l'√©quipe">
                </div>
                <div class="form-group">
                    <label>Logo (SVG uniquement)</label>
                    <div style="display:flex;align-items:center;gap:12px;">
                        <img id="teamSettingsLogoPreview" src="" style="height:48px;display:none;border:1px solid #eee;border-radius:8px;padding:4px;">
                        <button class="btn btn-secondary" onclick="uploadTeamLogo()"><i class="fas fa-upload"></i> Changer le logo</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="document.getElementById('teamSettingsModal').style.display='none'">Annuler</button>
                    <button class="btn btn-primary" onclick="saveTeamSettings()"><i class="fas fa-save"></i> Enregistrer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- File Info Panel -->
    <div class="info-panel-overlay" id="infoPanelOverlay" style="display:none;" onclick="closeFileInfoPanel()"></div>
    <div class="info-panel" id="infoPanel" style="display:none;">
        <div class="info-panel-header">
            <h3 id="infoPanelTitle">Informations</h3>
            <button class="btn-close" onclick="closeFileInfoPanel()"><i class="fas fa-times"></i></button>
        </div>
        <div class="info-panel-body" id="infoPanelBody">
            <div class="spinner"></div>
        </div>
    </div>

    <script src="js/user.js?v=20260220k"></script>
    <!-- Modal Corbeille -->
    <div class="modal-overlay" id="trashModal" style="display: none;">
        <div class="modal-content" style="max-width: 750px;">
            <div class="modal-header">
                <h3><i class="fas fa-trash-alt" style="color:#ef5350;"></i> Corbeille</h3>
                <button class="btn-close" onclick="document.getElementById('trashModal').style.display='none'"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;flex-wrap:wrap;gap:8px;">
                    <small style="color:#888;">Les fichiers en corbeille sont archiv√©s. Suppression auto apr√®s 30 jours.</small>
                    <div style="display:flex;gap:8px;" id="trashActions" style="display:none;">
                        <button class="btn btn-small" id="restoreAllTrashBtn" onclick="restoreAllTrash()" style="display:none;background:#4caf50;color:#fff;border:none;padding:6px 14px;border-radius:6px;cursor:pointer;font-size:0.8rem;">
                            <i class="fas fa-undo"></i> Tout restaurer
                        </button>
                        <button class="btn btn-danger btn-small" id="emptyTrashBtn" onclick="emptyTrash()" style="display:none;">
                            <i class="fas fa-trash"></i> Vider la corbeille
                        </button>
                    </div>
                </div>
                <div id="trashFilesList" style="max-height:450px;overflow-y:auto;"></div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="modal-overlay" id="previewModal" style="display:none;" onclick="if(event.target===this)closePreview()">
        <div class="preview-container">
            <div class="preview-header">
                <div class="preview-title" id="previewTitle">Aper√ßu</div>
                <div class="preview-actions">
                    <button class="btn-icon" id="previewToggleComments" title="Commentaires" onclick="toggleCommentsPanel()"><i class="fas fa-comment"></i> <span id="commentCount" style="font-size:0.75rem;"></span></button>
                    <button class="btn-icon" id="previewDownloadBtn" title="T√©l√©charger"><i class="fas fa-download"></i></button>
                    <button class="btn-icon" onclick="closePreview()" title="Fermer"><i class="fas fa-times"></i></button>
                </div>
            </div>
            <div style="display:flex;flex:1;overflow:hidden;">
                <div class="preview-body" id="previewBody" style="flex:1;">
                    <div class="spinner"></div>
                </div>
                <div class="comments-panel" id="commentsPanel" style="display:none;">
                    <div class="comments-header">üí¨ Commentaires</div>
                    <div class="comments-list" id="commentsList"></div>
                    <div class="comments-input">
                        <textarea id="commentInput" placeholder="Ajouter un commentaire..." rows="2"></textarea>
                        <button class="btn btn-primary btn-sm" onclick="addComment()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

