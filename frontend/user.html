<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShareAzure - Mon espace de stockage</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="css/user.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="user-header">
        <div class="header-container">
            <div class="header-left">
                <img src="logo-april.svg" alt="APRIL" class="header-logo">
                <h1 class="header-title">Mon espace de stockage</h1>
            </div>
            <div class="header-right">
                <button class="btn-icon" id="teamFilesBtn" title="Fichiers d'equipe" style="display: none;">
                    <i class="fas fa-users"></i>
                </button>
                <button class="btn-icon" id="shareLinksBtn" title="Mes liens de partage">
                    <i class="fas fa-link"></i>
                </button>
                <button class="btn-icon" id="discoverBtn" title="Decouvrir">
                    <i class="fas fa-compass"></i>
                </button>
                <button class="btn-icon" id="createGuestBtn" title="Créer un compte invité">
                    <i class="fas fa-user-plus"></i>
                </button>
                <button class="btn-icon" id="createFolderBtn" title="Créer un dossier">
                    <i class="fas fa-folder-plus"></i>
                </button>
                <button class="btn-icon" id="uploadBtn" title="Uploader un fichier">
                    <i class="fas fa-cloud-upload-alt"></i>
                </button>
                <button class="btn-icon" id="refreshBtn" title="Actualiser">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <div class="user-menu">
                    <span class="user-name" id="userName">Utilisateur</span>
                    <button class="btn-icon" id="logoutBtn" title="Déconnexion">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="user-main">
        <!-- Toolbar -->
        <div class="toolbar">
            <div class="toolbar-left">
                <button class="btn-view active" data-view="grid" title="Vue grille">
                    <i class="fas fa-th"></i>
                </button>
                <button class="btn-view" data-view="list" title="Vue liste">
                    <i class="fas fa-list"></i>
                </button>
                <div class="view-separator"></div>
                <button class="btn-filter" id="filterBtn" title="Filtrer">
                    <i class="fas fa-filter"></i>
                    <span>Filtrer</span>
                </button>
            </div>
            <div class="toolbar-right">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Rechercher un fichier...">
                </div>
            </div>
        </div>

        <!-- Filter Panel -->
        <div class="filter-panel" id="filterPanel" style="display: none;">
            <div class="filter-group">
                <label>Type de fichier</label>
                <select id="typeFilter" class="filter-select">
                    <option value="">Tous les types</option>
                    <option value="image">Images</option>
                    <option value="video">Vidéos</option>
                    <option value="audio">Audio</option>
                    <option value="document">Documents</option>
                    <option value="other">Autres</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Trier par</label>
                <select id="sortFilter" class="filter-select">
                    <option value="date-desc">Plus récent</option>
                    <option value="date-asc">Plus ancien</option>
                    <option value="name-asc">Nom (A-Z)</option>
                    <option value="name-desc">Nom (Z-A)</option>
                    <option value="size-desc">Plus volumineux</option>
                    <option value="size-asc">Plus léger</option>
                </select>
            </div>
            <button class="btn btn-secondary" id="clearFiltersBtn">Réinitialiser</button>
        </div>

        <!-- Breadcrumb -->
        <div class="breadcrumb" id="breadcrumb">
            <button class="breadcrumb-item active" data-path="">
                <i class="fas fa-home"></i>
                <span>Accueil</span>
            </button>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Share Links Section -->
            <div class="share-links-section" id="shareLinksSection" style="display: none;">
                <div class="section-header">
                    <h2>Mes liens de partage</h2>
                    <button class="btn btn-secondary" id="closeShareLinksBtn">
                        <i class="fas fa-times"></i>
                        Fermer
                    </button>
                </div>
                <div class="share-links-container" id="shareLinksContainer">
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p>Chargement de vos liens de partage...</p>
                    </div>
                </div>
            </div>

            <!-- Team Files Section (read-only for team members) -->
            <div class="team-files-section" id="teamFilesSection" style="display: none;">
                <div class="section-header">
                    <h2 id="teamFilesSectionTitle">Fichiers d'equipe</h2>
                    <button class="btn btn-secondary" id="closeTeamFilesBtn">
                        <i class="fas fa-times"></i>
                        Fermer
                    </button>
                </div>
                <div class="team-files-container" id="teamFilesContainer">
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p>Chargement des fichiers d'equipe...</p>
                    </div>
                </div>
            </div>

            <!-- Discover Section -->
            <div class="discover-section" id="discoverSection" style="display: none;">
                <div class="section-header">
                    <h2><i class="fas fa-compass"></i> Decouvrir</h2>
                    <button class="btn btn-secondary" id="closeDiscoverBtn">
                        <i class="fas fa-times"></i>
                        Fermer
                    </button>
                </div>
                <div class="discover-tabs">
                    <button class="discover-tab active" data-tab="tags">
                        <i class="fas fa-tags"></i> Par Tags
                    </button>
                    <button class="discover-tab" data-tab="search">
                        <i class="fas fa-brain"></i> Recherche IA
                    </button>
                    <button class="discover-tab" data-tab="map">
                        <i class="fas fa-map-marked-alt"></i> Carte
                    </button>
                </div>

                <!-- Tab: Tags -->
                <div class="discover-tab-content" id="discoverTabTags">
                    <div class="discover-tag-cloud" id="discoverTagCloud">
                        <div class="loading-state">
                            <div class="spinner"></div>
                            <p>Chargement des tags...</p>
                        </div>
                    </div>
                    <div class="discover-tag-results" id="discoverTagResults" style="display: none;">
                        <button class="btn btn-secondary btn-sm" id="discoverBackToTags">
                            <i class="fas fa-arrow-left"></i> Retour aux tags
                        </button>
                        <h3 id="discoverTagResultsTitle" style="margin: 1rem 0;"></h3>
                        <div class="discover-results-grid" id="discoverTagFilesGrid"></div>
                    </div>
                </div>

                <!-- Tab: Search -->
                <div class="discover-tab-content" id="discoverTabSearch" style="display: none;">
                    <div class="discover-search-bar">
                        <div class="discover-search-input-wrapper">
                            <i class="fas fa-search"></i>
                            <input type="text" id="discoverSearchInput" placeholder="Rechercher par description, tags, contenu...">
                            <div class="discover-suggestions" id="discoverSuggestions" style="display: none;"></div>
                        </div>
                        <select id="discoverSearchType" class="filter-select">
                            <option value="">Tous les types</option>
                            <option value="image">Images</option>
                            <option value="video">Videos</option>
                            <option value="audio">Audio</option>
                            <option value="document">Documents</option>
                        </select>
                        <button class="btn btn-primary" id="discoverSearchBtn">
                            <i class="fas fa-search"></i> Rechercher
                        </button>
                    </div>
                    <div class="discover-results-grid" id="discoverSearchResultsGrid"></div>
                </div>

                <!-- Tab: Map -->
                <div class="discover-tab-content" id="discoverTabMap" style="display: none;">
                    <div id="discover-map"></div>
                    <p class="discover-map-counter" id="discoverMapCounter"></p>
                </div>
            </div>

            <!-- Files Section -->
            <div class="files-section" id="filesSection">
            <!-- Grid View -->
            <div class="files-grid" id="filesGrid">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Chargement de vos fichiers...</p>
                </div>
            </div>

            <!-- List View -->
            <div class="files-list" id="filesList" style="display: none;">
                <table class="files-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Taille</th>
                            <th>Type</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="filesTableBody">
                        <tr>
                            <td colspan="5" class="loading">Chargement...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <i class="fas fa-folder-open"></i>
                <h3>Aucun fichier</h3>
                <p>Commencez par uploader vos premiers fichiers</p>
                <button class="btn btn-primary" id="uploadEmptyBtn">
                    <i class="fas fa-cloud-upload-alt"></i>
                    Uploader un fichier
                </button>
            </div>
            </div>
            <!-- End Files Section -->
        </div>
    </main>

    <!-- Upload Modal -->
    <div class="modal-overlay" id="uploadModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Uploader des fichiers</h3>
                <button class="btn-close" id="closeUploadBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="upload-zone" id="uploadZone">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Glissez-déposez vos fichiers ici</p>
                    <p class="upload-hint">ou</p>
                    <input type="file" id="fileInput" multiple hidden>
                    <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                        Choisir des fichiers
                    </button>
                    <p class="upload-limit">Taille maximale : 100 Mo par fichier</p>
                </div>
                <div class="upload-progress" id="uploadProgress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <p class="progress-text" id="progressText">0%</p>
                </div>
                <div class="upload-files-list" id="uploadFilesList"></div>
            </div>
        </div>
    </div>

    <!-- Create Folder Modal -->
    <div class="modal-overlay" id="createFolderModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Créer un dossier</h3>
                <button class="btn-close" id="closeCreateFolderBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="folderNameInput">Nom du dossier</label>
                    <input type="text" id="folderNameInput" class="form-input" placeholder="Entrez le nom du dossier" autofocus>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelCreateFolderBtn">Annuler</button>
                    <button class="btn btn-primary" id="confirmCreateFolderBtn">Créer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu" style="display: none;">
        <button class="context-menu-item" id="contextRename">
            <i class="fas fa-edit"></i>
            <span>Renommer</span>
        </button>
        <button class="context-menu-item" id="contextMove">
            <i class="fas fa-arrows-alt"></i>
            <span>Déplacer</span>
        </button>
        <button class="context-menu-item" id="contextShare">
            <i class="fas fa-share-alt"></i>
            <span>Partager</span>
        </button>
        <button class="context-menu-item context-menu-item-danger" id="contextDelete">
            <i class="fas fa-trash"></i>
            <span>Supprimer</span>
        </button>
    </div>

    <!-- Rename Modal -->
    <div class="modal-overlay" id="renameModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="renameModalTitle">Renommer</h3>
                <button class="btn-close" id="closeRenameBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="renameInput">Nouveau nom</label>
                    <input type="text" id="renameInput" class="form-input" autofocus>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelRenameBtn">Annuler</button>
                    <button class="btn btn-primary" id="confirmRenameBtn">Renommer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Move Modal -->
    <div class="modal-overlay" id="moveModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Déplacer</h3>
                <button class="btn-close" id="closeMoveBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="moveDestinationSelect">Destination</label>
                    <select id="moveDestinationSelect" class="form-select">
                        <option value="">Racine</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelMoveBtn">Annuler</button>
                    <button class="btn btn-primary" id="confirmMoveBtn">Déplacer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal-overlay" id="shareModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="shareModalTitle">Partager le fichier</h3>
                <button class="btn-close" id="closeShareBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Emails des destinataires <span style="color: red;">*</span></label>
                    <input 
                        type="text" 
                        id="shareRecipientEmailInput" 
                        class="form-input" 
                        placeholder="email1@example.com, email2@example.com"
                        required
                    >
                    <small style="color: #666; font-size: 0.875rem;">Séparez plusieurs emails par des virgules</small>
                </div>
                <div class="form-group">
                    <label>Lien de partage</label>
                    <div class="share-link-container" style="display: flex; gap: 5px;">
                        <input type="text" id="shareLinkInput" class="form-input" readonly style="flex: 1;">
                        <button class="btn btn-icon" id="refreshShareLinkBtn" title="Régénérer le lien">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button class="btn btn-icon" id="copyShareLinkBtn" title="Copier le lien">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Expiration</label>
                    <select id="shareExpirationSelect" class="form-select">
                        <option value="1">1 heure</option>
                        <option value="24" selected>24 heures</option>
                        <option value="168">7 jours</option>
                        <option value="720">30 jours</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="sharePasswordCheck">
                        Protéger par mot de passe
                    </label>
                    <input type="password" id="sharePasswordInput" class="form-input" placeholder="Mot de passe (optionnel)" style="display: none;">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelShareBtn">Fermer</button>
                    <button class="btn btn-primary" id="applyShareBtn">Appliquer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Guest Modal -->
    <div class="modal-overlay" id="createGuestModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Créer un compte invité</h3>
                <button class="btn-close" id="closeCreateGuestBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="guestEmailInput">Email de l'invité <span style="color: red;">*</span></label>
                    <input type="email" id="guestEmailInput" class="form-input" placeholder="email@example.com" required autofocus>
                    <small style="color: #666; font-size: 0.875rem;">Un code de vérification sera envoyé à cet email</small>
                </div>
                <div class="guest-info-box" style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4 style="margin: 0 0 10px 0; font-size: 0.9rem; color: #0066cc;">
                        <i class="fas fa-info-circle"></i> Informations
                    </h4>
                    <ul style="margin: 0; padding-left: 20px; font-size: 0.85rem; color: #555;">
                        <li>Le code de vérification expirera dans 24 heures</li>
                        <li>Le compte invité sera valide pendant 3 jours</li>
                        <li>L'invité pourra uploader et télécharger des fichiers</li>
                    </ul>
                </div>
                <div id="guestCreateResult" style="display: none; padding: 12px; border-radius: 8px; margin-top: 15px;"></div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelCreateGuestBtn">Annuler</button>
                    <button class="btn btn-primary" id="confirmCreateGuestBtn">
                        <i class="fas fa-user-plus"></i>
                        Créer le compte
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div class="gallery-modal" id="galleryModal" style="display: none;">
        <div class="gallery-header">
            <button class="gallery-close" id="closeGalleryBtn">
                <i class="fas fa-times"></i>
            </button>
            <h3 id="galleryTitle">Galerie photo</h3>
            <div class="gallery-info">
                <span id="galleryCounter">1 / 1</span>
            </div>
        </div>
        <div class="gallery-content">
            <button class="gallery-nav gallery-prev" id="galleryPrevBtn">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="gallery-image-container">
                <img id="galleryImage" src="" alt="">
            </div>
            <button class="gallery-nav gallery-next" id="galleryNextBtn">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        <div class="gallery-thumbnails" id="galleryThumbnails"></div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal-overlay" id="confirmModal" style="display: none;">
        <div class="modal-content" style="max-width: 420px;">
            <div class="modal-header">
                <h3 id="confirmTitle">Confirmer</h3>
                <button class="modal-close" id="confirmCloseBtn">&times;</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <div style="font-size: 48px; color: #F8AA36; margin-bottom: 12px;">&#9888;</div>
                <p id="confirmMessage" style="color: var(--text-secondary); white-space: pre-line;"></p>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="confirmNoBtn">Annuler</button>
                    <button class="btn btn-danger" id="confirmYesBtn">Confirmer</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/user.js"></script>
</body>
</html>

