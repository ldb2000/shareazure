<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ShareAzure - Administration</title>
    <link rel="stylesheet" href="css/admin.css">
    <!-- Font Awesome pour les ic√¥nes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js pour les graphiques -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Leaflet.js pour la carte -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <svg class="sidebar-logo" viewBox="0 0 559 165" xmlns="http://www.w3.org/2000/svg">
                <g fill-rule="evenodd">
                    <path d="M58.5905 90.33H89.6405C74.3705 56.31 40.2205 34.02 0.560547 34.02V102.78C0.560547 117.89 12.9605 130.43 28.2105 129.97H65.9906C61.0006 120.61 58.5905 109.53 58.5905 97.79V90.33Z" fill="#639E30"/>
                    <path d="M133.171 164.02C96.971 164.02 68.041 135.72 68.041 99.8H105.101C120.491 99.8 133.181 112.34 133.181 127.88V164.02H133.171Z" fill="#F8AA36"/>
                </g>
            </svg>
            <h1>ShareAzure</h1>
            <p class="sidebar-subtitle">Administration</p>
        </div>

        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-item active" data-section="dashboard">
                <i class="fas fa-chart-line nav-icon"></i>
                <span class="nav-text">Dashboard</span>
            </a>
            <a href="#files" class="nav-item" data-section="files">
                <i class="fas fa-folder-open nav-icon"></i>
                <span class="nav-text">Fichiers</span>
            </a>
            <a href="#shares" class="nav-item" data-section="shares">
                <i class="fas fa-share-nodes nav-icon"></i>
                <span class="nav-text">Partages</span>
            </a>
            <a href="#teams" class="nav-item" data-section="teams">
                <i class="fas fa-users-gear nav-icon"></i>
                <span class="nav-text">Equipes</span>
            </a>
            <a href="#costs" class="nav-item" data-section="costs">
                <i class="fas fa-chart-line nav-icon"></i>
                <span class="nav-text">FinOps</span>
            </a>
            <a href="#storage" class="nav-item" data-section="storage">
                <span class="nav-icon">üíæ</span>
                <span class="nav-text">Stockage</span>
            </a>
            <a href="#users" class="nav-item" data-section="users">
                <i class="fas fa-users nav-icon"></i>
                <span class="nav-text">Utilisateurs</span>
            </a>
            <a href="#guests" class="nav-item" data-section="guests">
                <i class="fas fa-user-clock nav-icon"></i>
                <span class="nav-text">Invites</span>
            </a>
            <a href="#logs" class="nav-item" data-section="logs">
                <i class="fas fa-list-ul nav-icon"></i>
                <span class="nav-text">Logs</span>
            </a>
            <a href="#ai" class="nav-item" data-section="ai">
                <i class="fas fa-brain nav-icon"></i>
                <span class="nav-text">IA</span>
            </a>
            <a href="#faces" class="nav-item" data-section="faces">
                <i class="fas fa-face-smile nav-icon"></i>
                <span class="nav-text">Visages</span>
            </a>
            <a href="#audit" class="nav-item" data-section="audit">
                <i class="fas fa-shield-halved nav-icon"></i>
                <span class="nav-text">Audit S√©curit√©</span>
            </a>
            <a href="#settings" class="nav-item" data-section="settings">
                <i class="fas fa-cog nav-icon"></i>
                <span class="nav-text">Parametres</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="btn btn-secondary btn-small btn-block" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                Deconnexion
            </button>
            <p class="version">v3.0.0</p>
        </div>
    </aside>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="top-header">
            <div class="header-left">
                <button class="btn btn-icon mobile-menu-btn" id="mobileMenuBtn" title="Menu">
                    <i class="fas fa-bars"></i>
                </button>
                <h2 id="pageTitle">Dashboard</h2>
                <p id="pageSubtitle">Vue d'ensemble de l'activite</p>
            </div>
            <div class="header-right">
                <button class="btn btn-icon" id="refreshBtn" title="Rafraichir">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <div class="user-menu" id="userMenuToggle" style="cursor:pointer;position:relative;">
                    <img src="https://ui-avatars.com/api/?name=Admin&background=003C61&color=fff" alt="Admin" class="user-avatar">
                    <span class="user-name" id="currentUserName">Admin</span>
                    <div class="user-dropdown" id="userDropdown" style="display:none;position:absolute;top:100%;right:0;margin-top:8px;background:#fff;border:1px solid #e0e0e0;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);min-width:160px;z-index:200;">
                        <button onclick="document.getElementById('logoutBtn').click();document.getElementById('userDropdown').style.display='none';" style="display:flex;align-items:center;gap:8px;width:100%;padding:12px 16px;border:none;background:none;cursor:pointer;font-size:0.9rem;color:#d32f2f;">
                            <i class="fas fa-sign-out-alt"></i> D√©connexion
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section active">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon stat-icon-blue">
                        <i class="fas fa-folder-open"></i>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Total Fichiers</p>
                        <h3 class="stat-value" id="statTotalFiles">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-icon-green">
                        <i class="fas fa-users-gear"></i>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Equipes</p>
                        <h3 class="stat-value" id="statTotalTeams">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-icon-orange">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Utilisateurs</p>
                        <h3 class="stat-value" id="statTotalUsers">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-icon-red">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Couts ce mois</p>
                        <h3 class="stat-value" id="statTotalCosts">$0.00</h3>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="charts-row">
                <div class="chart-card">
                    <h3><i class="fas fa-chart-line"></i> Uploads par jour (7 derniers jours)</h3>
                    <canvas id="uploadsChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3><i class="fas fa-chart-pie"></i> Types de fichiers</h3>
                    <canvas id="fileTypesChart"></canvas>
                </div>
            </div>

            <!-- Storage Usage Mini Bar -->
            <div class="chart-card" id="dashStorageCard" style="display:none;">
                <h3><i class="fas fa-database"></i> Utilisation du stockage</h3>
                <div style="display:flex;align-items:center;gap:16px;margin-top:8px;">
                    <div style="flex:1;height:24px;background:#e5e7eb;border-radius:12px;overflow:hidden;display:flex;" id="dashStorageBar"></div>
                    <span id="dashStorageLabel" style="font-weight:600;white-space:nowrap;"></span>
                </div>
                <div id="dashStorageLegend" style="display:flex;gap:16px;margin-top:8px;font-size:0.8rem;color:#6b7280;"></div>
            </div>

            <!-- Recent Activity -->
            <div class="activity-card">
                <h3><i class="fas fa-clock"></i> Activit√© r√©cente</h3>
                <div class="activity-list" id="recentActivity">
                    <p class="loading">Chargement...</p>
                </div>
            </div>
        </section>

        <!-- Files Section -->
        <section id="files" class="content-section">
            <div class="section-toolbar">
                <div class="search-box">
                    <input type="text" id="fileSearchInput" placeholder="Rechercher un fichier...">
                </div>
                <div class="toolbar-actions">
                    <select id="fileTypeFilter" class="filter-select">
                        <option value="">Tous les types</option>
                        <option value="Images">Images</option>
                        <option value="PDF">PDF</option>
                        <option value="Vid√©os">Videos</option>
                        <option value="Audio">Audio</option>
                        <option value="Documents">Documents</option>
                        <option value="Autres">Autres</option>
                    </select>
                    <select id="fileSortBy" class="filter-select">
                        <option value="date-desc">Plus recent</option>
                        <option value="date-asc">Plus ancien</option>
                        <option value="size-desc">Plus volumineux</option>
                        <option value="size-asc">Plus leger</option>
                        <option value="name-asc">Nom (A-Z)</option>
                        <option value="name-desc">Nom (Z-A)</option>
                    </select>
                    <button class="btn btn-danger" id="deleteSelectedBtn" disabled>
                        <i class="fas fa-trash"></i> Supprimer selection
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table" id="filesTable">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAllFiles"></th>
                            <th>Nom</th>
                            <th>√âquipe</th>
                            <th>Type</th>
                            <th>Taille</th>
                            <th>Date d'upload</th>
                            <th>Tier</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="filesTableBody">
                        <tr><td colspan="8" class="loading">Chargement des fichiers...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Shares Section -->
        <section id="shares" class="content-section">
            <div class="section-toolbar">
                <div class="search-box">
                    <input type="text" id="shareSearchInput" placeholder="Rechercher un partage...">
                </div>
                <div class="toolbar-actions">
                    <select id="shareStatusFilter" class="filter-select">
                        <option value="">Tous les statuts</option>
                        <option value="active">Actifs</option>
                        <option value="expired">Expires</option>
                    </select>
                    <button class="btn btn-primary" id="exportSharesBtn">
                        <i class="fas fa-download"></i> Exporter CSV
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table" id="sharesTable">
                    <thead>
                        <tr>
                            <th>Fichier</th>
                            <th>Cree le</th>
                            <th>Expire le</th>
                            <th>Statut</th>
                            <th>Telechargements</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="sharesTableBody">
                        <tr><td colspan="6" class="loading">Chargement des partages...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Teams Section -->
        <section id="teams" class="content-section">
            <div class="section-toolbar">
                <h3 style="margin: 0;">Gestion des Equipes</h3>
                <div class="toolbar-actions">
                    <button class="btn btn-primary" id="createTeamBtn">
                        <i class="fas fa-plus"></i> Creer une equipe
                    </button>
                </div>
            </div>
            <div class="table-container" id="teamsList">
                <p class="loading">Chargement...</p>
            </div>
        </section>

        <!-- Costs Section -->
        <section id="costs" class="content-section">
            <div class="section-toolbar">
                <h3 style="margin: 0;"><i class="fas fa-chart-line"></i> FinOps ‚Äî Suivi des co√ªts Azure</h3>
                <div class="toolbar-actions">
                    <button class="btn btn-secondary" onclick="loadFinOps()">
                        <i class="fas fa-sync"></i> Actualiser
                    </button>
                    <button class="btn btn-secondary" onclick="recalculateFinOps()">
                        <i class="fas fa-calculator"></i> Recalculer
                    </button>
                    <button class="btn btn-primary" onclick="sendFinOpsReport()">
                        <i class="fas fa-envelope"></i> Envoyer par email
                    </button>
                </div>
            </div>

            <!-- Co√ªt total hero -->
            <div style="display:flex;justify-content:center;gap:32px;flex-wrap:wrap;margin:20px 0;padding:24px;background:linear-gradient(135deg,#0f172a,#1e3a5f);border-radius:12px;color:#fff;">
                <div style="text-align:center;">
                    <div id="finopsTotalCost" style="font-size:2.2rem;font-weight:800;color:#0d9488;">‚Äî</div>
                    <div style="font-size:0.85rem;color:#94a3b8;">Co√ªt total ce mois</div>
                </div>
                <div style="text-align:center;">
                    <div id="finopsForecast" style="font-size:2.2rem;font-weight:800;color:#f59e0b;">‚Äî</div>
                    <div style="font-size:0.85rem;color:#94a3b8;">Projection fin de mois</div>
                </div>
            </div>

            <!-- Breakdown -->
            <div id="finopsBreakdownBar" style="margin-bottom:20px;">
                <div style="background:#e5e7eb;border-radius:8px;height:28px;overflow:hidden;display:flex;" id="finopsBar"></div>
                <div style="display:flex;gap:16px;margin-top:6px;font-size:0.8rem;color:#64748b;" id="finopsBarLegend"></div>
            </div>

            <!-- Stockage par tier -->
            <h4 style="margin:20px 0 12px;color:#0a1628;"><i class="fas fa-database"></i> Stockage par tier</h4>
            <div class="stats-grid" style="margin-bottom:20px;" id="finopsTierCards">
                <div class="stat-card"><p class="loading">Chargement...</p></div>
            </div>

            <!-- Op√©rations -->
            <h4 style="margin:20px 0 12px;color:#0a1628;"><i class="fas fa-bolt"></i> Op√©rations du mois</h4>
            <div class="stats-grid" style="margin-bottom:20px;" id="finopsOpsCards">
                <div class="stat-card"><p class="loading">Chargement...</p></div>
            </div>

            <!-- Co√ªts par utilisateur -->
            <h4 style="margin:20px 0 12px;color:#0a1628;"><i class="fas fa-user"></i> Co√ªts par utilisateur</h4>
            <div class="table-container">
                <table><thead><tr><th>Utilisateur</th><th>Stockage</th><th>Hot</th><th>Cool</th><th>Archive</th><th>Op√©rations</th><th>Total</th></tr></thead>
                <tbody id="finopsUsersTable"><tr><td colspan="7" class="loading">Chargement...</td></tr></tbody></table>
            </div>

            <!-- Co√ªts par √©quipe -->
            <h4 style="margin:20px 0 12px;color:#0a1628;"><i class="fas fa-users"></i> Co√ªts par √©quipe</h4>
            <div class="table-container">
                <table><thead><tr><th>√âquipe</th><th>Stockage</th><th>Hot</th><th>Cool</th><th>Op√©rations</th><th>Total</th></tr></thead>
                <tbody id="finopsTeamsTable"><tr><td colspan="6" class="loading">Chargement...</td></tr></tbody></table>
            </div>

            <!-- Top fichiers -->
            <h4 style="margin:20px 0 12px;color:#0a1628;"><i class="fas fa-file-invoice-dollar"></i> Top 10 fichiers les plus co√ªteux</h4>
            <div class="table-container">
                <table><thead><tr><th>Fichier</th><th>Propri√©taire</th><th>Taille</th><th>Tier</th><th>Co√ªt/mois</th></tr></thead>
                <tbody id="finopsFilesTable"><tr><td colspan="5" class="loading">Chargement...</td></tr></tbody></table>
            </div>

            <!-- Grille tarifaire -->
            <h4 style="margin:20px 0 12px;color:#0a1628;"><i class="fas fa-euro-sign"></i> Grille tarifaire Azure (France Central, LRS)</h4>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:20px;">
                <div style="background:#fff5f5;border:1px solid #fecaca;border-top:3px solid #ef4444;border-radius:8px;padding:16px;text-align:center;">
                    <h4 style="color:#ef4444;">üî¥ Hot</h4>
                    <div style="font-size:1.2rem;font-weight:700;">0.0184 ‚Ç¨/Go/mois</div>
                    <div style="font-size:0.8rem;color:#666;margin-top:4px;">Write: 0.05‚Ç¨/10k ¬∑ Read: 0.004‚Ç¨/10k</div>
                </div>
                <div style="background:#eff6ff;border:1px solid #bfdbfe;border-top:3px solid #3b82f6;border-radius:8px;padding:16px;text-align:center;">
                    <h4 style="color:#3b82f6;">üîµ Cool</h4>
                    <div style="font-size:1.2rem;font-weight:700;">0.01 ‚Ç¨/Go/mois</div>
                    <div style="font-size:0.8rem;color:#666;margin-top:4px;">Write: 0.10‚Ç¨/10k ¬∑ Read: 0.01‚Ç¨/10k ¬∑ Acc√®s: 0.01‚Ç¨/Go</div>
                </div>
                <div style="background:#f9fafb;border:1px solid #d1d5db;border-top:3px solid #6b7280;border-radius:8px;padding:16px;text-align:center;">
                    <h4 style="color:#6b7280;">‚ö´ Archive</h4>
                    <div style="font-size:1.2rem;font-weight:700;">0.00099 ‚Ç¨/Go/mois</div>
                    <div style="font-size:0.8rem;color:#666;margin-top:4px;">Write: 0.10‚Ç¨/10k ¬∑ Read: 5.00‚Ç¨/10k ¬∑ R√©hydratation: 0.022‚Ç¨/Go</div>
                </div>
            </div>
        </section>

        <!-- Storage Section -->
        <section id="storage" class="content-section">
            <div id="syncBanner" style="background:#fff3e0;border:1px solid #ffcc02;border-radius:8px;padding:16px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;">
                <div>
                    <strong>üîÑ Synchronisation Azure ‚Üí Base de donn√©es</strong>
                    <p style="margin:4px 0 0;color:#555;font-size:0.9rem;">Importer les fichiers existants dans Azure Blob Storage dans la base de donn√©es ShareAzure</p>
                </div>
                <div style="display:flex;gap:8px;">
                    <button class="btn btn-secondary" onclick="previewSync()">üëÅÔ∏è Aper√ßu</button>
                    <button class="btn btn-primary" onclick="runSync()">üîÑ Synchroniser</button>
                    <button class="btn btn-primary" style="background:#c62828;" onclick="confirmResetStorage()">üóëÔ∏è Reset Storage</button>
                </div>
                <div id="syncResult" style="width:100%;display:none;margin-top:8px;"></div>
            </div>
            <div class="stats-grid" id="storageStats">
                <div class="stat-card">
                    <div class="stat-icon stat-icon-blue"><i class="fas fa-database"></i></div>
                    <div class="stat-content">
                        <p class="stat-label">Espace total</p>
                        <h3 class="stat-value" id="storTotalSize">‚Äî</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-icon-green"><i class="fas fa-file"></i></div>
                    <div class="stat-content">
                        <p class="stat-label">Fichiers</p>
                        <h3 class="stat-value" id="storTotalFiles">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(239,68,68,0.1);color:#ef4444;"><i class="fas fa-fire"></i></div>
                    <div class="stat-content">
                        <p class="stat-label">Tier Hot</p>
                        <h3 class="stat-value" id="storHot">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(59,130,246,0.1);color:#3b82f6;"><i class="fas fa-snowflake"></i></div>
                    <div class="stat-content">
                        <p class="stat-label">Tier Cool</p>
                        <h3 class="stat-value" id="storCool">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(107,114,128,0.1);color:#6b7280;"><i class="fas fa-archive"></i></div>
                    <div class="stat-content">
                        <p class="stat-label">Tier Archive</p>
                        <h3 class="stat-value" id="storArchive">0</h3>
                    </div>
                </div>
            </div>

            <!-- Storage breakdown bar -->
            <div class="chart-card">
                <h3><i class="fas fa-chart-bar"></i> R√©partition par tier</h3>
                <div id="storageTierBar" style="height:40px;border-radius:8px;overflow:hidden;display:flex;margin-top:12px;"></div>
                <div id="storageTierLegend" style="display:flex;gap:20px;margin-top:12px;font-size:0.85rem;"></div>
            </div>

            <!-- Storage by file type -->
            <div class="chart-card">
                <h3><i class="fas fa-file-alt"></i> Stockage par type de fichier</h3>
                <div id="storageByTypeContent"></div>
            </div>

            <!-- Top 10 biggest files -->
            <div class="chart-card">
                <h3><i class="fas fa-weight-hanging"></i> Top 10 fichiers les plus volumineux</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead><tr><th>Nom</th><th>Taille</th><th>Type</th><th>Tier</th></tr></thead>
                        <tbody id="storTopFilesBody"><tr><td colspan="4">Chargement...</td></tr></tbody>
                    </table>
                </div>
            </div>

            <!-- Storage by team -->
            <div class="chart-card">
                <h3><i class="fas fa-users-gear"></i> Stockage par √©quipe</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead><tr><th>√âquipe</th><th>Fichiers</th><th>Taille</th><th>Part</th></tr></thead>
                        <tbody id="storByTeamBody"><tr><td colspan="4">Chargement...</td></tr></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Users Section -->
        <section id="users" class="content-section">
            <div class="section-toolbar">
                <div class="toolbar-actions">
                    <button class="btn btn-primary" id="createUserBtn">
                        <i class="fas fa-plus"></i> Creer un utilisateur
                    </button>
                </div>
            </div>
            <div class="table-container" id="usersList">
                <p class="loading">Chargement...</p>
            </div>
        </section>

        <!-- Guests Section -->
        <section id="guests" class="content-section">
            <div class="section-toolbar">
                <div class="toolbar-actions">
                    <select id="guestStatusFilter" class="filter-select">
                        <option value="">Tous les statuts</option>
                        <option value="active">Actifs</option>
                        <option value="expired">Expires</option>
                        <option value="disabled">Desactives</option>
                    </select>
                    <button class="btn btn-primary" id="createGuestBtn">
                        <i class="fas fa-user-plus"></i> Creer un invite
                    </button>
                </div>
                <div class="search-box">
                    <input type="text" id="guestSearch" placeholder="Rechercher par email...">
                </div>
            </div>

            <div class="stats-grid" style="margin-bottom: 2rem;">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-users"></i></div>
                    <div class="stat-content">
                        <p class="stat-label">Total invites</p>
                        <h3 class="stat-value" id="totalGuestsCount">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #639E30, #4A7523); color: white;"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-content">
                        <p class="stat-label">Actifs</p>
                        <h3 class="stat-value" id="activeGuestsCount">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #F8AA36, #E69A26); color: white;"><i class="fas fa-clock"></i></div>
                    <div class="stat-content">
                        <p class="stat-label">Expirent bientot</p>
                        <h3 class="stat-value" id="expiringSoonCount">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #DC2626, #B91C1C); color: white;"><i class="fas fa-ban"></i></div>
                    <div class="stat-content">
                        <p class="stat-label">Desactives</p>
                        <h3 class="stat-value" id="disabledGuestsCount">0</h3>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Cree par</th>
                            <th>Fichiers</th>
                            <th>Cree le</th>
                            <th>Expire le</th>
                            <th>Temps restant</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="guestsTableBody">
                        <tr><td colspan="8" class="loading">Chargement...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Logs Section -->
        <section id="logs" class="content-section">
            <div class="section-toolbar">
                <div class="search-box">
                    <input type="text" id="logSearchInput" placeholder="Rechercher dans les logs...">
                </div>
                <div class="toolbar-actions">
                    <select id="logLevelFilter" class="filter-select">
                        <option value="">Tous les niveaux</option>
                        <option value="info">Info</option>
                        <option value="success">Succes</option>
                        <option value="warning">Warning</option>
                        <option value="error">Erreur</option>
                    </select>
                    <select id="logCategoryFilter" class="filter-select">
                        <option value="">Toutes les categories</option>
                        <option value="file">Fichiers</option>
                        <option value="share">Partages</option>
                        <option value="domain">Domaines</option>
                        <option value="user">Utilisateurs</option>
                        <option value="auth">Authentification</option>
                        <option value="system">Systeme</option>
                    </select>
                    <button class="btn btn-secondary" id="clearLogsBtn">
                        <i class="fas fa-trash"></i> Effacer
                    </button>
                    <button class="btn btn-primary" id="exportLogsBtn">
                        <i class="fas fa-download"></i> Exporter
                    </button>
                </div>
            </div>
            <div class="table-container">
                <table class="data-table" id="logsTable">
                    <thead>
                        <tr>
                            <th style="width: 160px;">Date</th>
                            <th style="width: 90px;">Niveau</th>
                            <th style="width: 110px;">Categorie</th>
                            <th>Message</th>
                            <th style="width: 120px;">Utilisateur</th>
                        </tr>
                    </thead>
                    <tbody id="logsTableBody">
                        <tr><td colspan="5" class="loading">Chargement des logs...</td></tr>
                    </tbody>
                </table>
            </div>
            <div id="logsPagination" class="logs-pagination" style="display: none;">
                <span id="logsCount" class="logs-page-info"></span>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <button class="btn btn-secondary btn-small" id="logsPrevBtn" disabled>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span id="logsPageInfo" class="logs-page-info"></span>
                    <button class="btn btn-secondary btn-small" id="logsNextBtn" disabled>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- AI Section -->
        <section id="ai" class="content-section">
            <!-- AI Sub-tabs -->
            <div class="ai-tabs">
                <button class="ai-tab active" data-ai-tab="ai-dashboard">Dashboard</button>
                <button class="ai-tab" data-ai-tab="ai-services">Services</button>
                <button class="ai-tab" data-ai-tab="ai-params">Parametres</button>
                <button class="ai-tab" data-ai-tab="ai-scans">Scans</button>
                <button class="ai-tab" data-ai-tab="ai-map">Carte</button>
            </div>

            <!-- AI Dashboard Sub-tab -->
            <div id="ai-dashboard" class="ai-tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-image"></i></div>
                        <div class="stat-info">
                            <h3 id="aiAnalysisCount">0</h3>
                            <p>Analyses</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                        <div class="stat-info">
                            <h3 id="aiMonthlyCost">$0.00</h3>
                            <p>Cout mensuel</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-chart-pie"></i></div>
                        <div class="stat-info">
                            <h3 id="aiBudgetUsed">0%</h3>
                            <p>Budget utilise</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-spinner"></i></div>
                        <div class="stat-info">
                            <h3 id="aiQueueSize">0</h3>
                            <p>File d'attente</p>
                        </div>
                    </div>
                </div>
                <div class="stats-grid" style="margin-top: 20px;">
                    <div class="card">
                        <h3>Top Tags</h3>
                        <div id="aiTopTags" class="tag-cloud">Chargement...</div>
                    </div>
                    <div class="card">
                        <h3>Couts par service</h3>
                        <div id="aiCostByService">Chargement...</div>
                    </div>
                </div>
            </div>

            <!-- AI Services Sub-tab -->
            <div id="ai-services" class="ai-tab-content">
                <!-- Interrupteur global -->
                <div class="ai-global-toggle" style="display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; margin-bottom: 24px; background: linear-gradient(135deg, #0066CC 0%, #004C99 100%); border-radius: 12px; color: white;">
                    <div>
                        <h3 style="margin: 0; color: white; font-size: 1.1rem;"><i class="fas fa-brain"></i> &nbsp;Intelligence Artificielle</h3>
                        <p style="margin: 4px 0 0; opacity: 0.85; font-size: 0.85rem;">Active ou desactive tous les services IA</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="aiSvc_aiEnabled">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <!-- Grille de services -->
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px;" id="aiServicesGrid">

                    <!-- Analyse d'images -->
                    <div class="settings-card" style="margin: 0; padding: 20px;">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
                                    <span style="display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 10px; background: rgba(0,102,204,0.1); color: #0066CC; font-size: 1rem;"><i class="fas fa-eye"></i></span>
                                    <strong style="font-size: 0.95rem;">OpenAI GPT-4 Vision</strong>
                                </div>
                                <p style="margin: 0; font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">Analyse intelligente des images : description, tags, detection d'objets et de scenes.</p>
                            </div>
                            <label class="toggle-switch" style="flex-shrink: 0; margin-top: 6px;">
                                <input type="checkbox" id="aiSvc_openaiEnabled">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Azure AI Vision -->
                    <div class="settings-card" style="margin: 0; padding: 20px;">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
                                    <span style="display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 10px; background: rgba(0,179,136,0.1); color: #00B388; font-size: 1rem;"><i class="fab fa-microsoft"></i></span>
                                    <strong style="font-size: 0.95rem;">Azure AI Vision</strong>
                                </div>
                                <p style="margin: 0; font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">Service Microsoft Azure pour l'analyse d'images, OCR et detection de contenu.</p>
                            </div>
                            <label class="toggle-switch" style="flex-shrink: 0; margin-top: 6px;">
                                <input type="checkbox" id="aiSvc_azureVisionEnabled">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Whisper -->
                    <div class="settings-card" style="margin: 0; padding: 20px;">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
                                    <span style="display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 10px; background: rgba(139,92,246,0.1); color: #8B5CF6; font-size: 1rem;"><i class="fas fa-microphone"></i></span>
                                    <strong style="font-size: 0.95rem;">Whisper (transcription)</strong>
                                </div>
                                <p style="margin: 0; font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">Transcription automatique des fichiers audio et video en texte via OpenAI Whisper.</p>
                            </div>
                            <label class="toggle-switch" style="flex-shrink: 0; margin-top: 6px;">
                                <input type="checkbox" id="aiSvc_transcriptionEnabled">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Reconnaissance faciale -->
                    <div class="settings-card" style="margin: 0; padding: 20px;">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
                                    <span style="display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 10px; background: rgba(236,72,153,0.1); color: #EC4899; font-size: 1rem;"><i class="fas fa-user-circle"></i></span>
                                    <strong style="font-size: 0.95rem;">Reconnaissance faciale</strong>
                                </div>
                                <p style="margin: 0; font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">Detecte et identifie les visages dans vos photos. Galerie de profils et regroupement automatique.</p>
                            </div>
                            <label class="toggle-switch" style="flex-shrink: 0; margin-top: 6px;">
                                <input type="checkbox" id="aiSvc_faceRecognitionEnabled">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Geolocalisation -->
                    <div class="settings-card" style="margin: 0; padding: 20px;">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
                                    <span style="display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 10px; background: rgba(245,158,11,0.1); color: #F59E0B; font-size: 1rem;"><i class="fas fa-map-marker-alt"></i></span>
                                    <strong style="font-size: 0.95rem;">Geolocalisation</strong>
                                </div>
                                <p style="margin: 0; font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">Extraction GPS depuis les metadonnees EXIF. Affichage sur carte interactive.</p>
                            </div>
                            <label class="toggle-switch" style="flex-shrink: 0; margin-top: 6px;">
                                <input type="checkbox" id="aiSvc_geolocationEnabled">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Recherche semantique -->
                    <div class="settings-card" style="margin: 0; padding: 20px;">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
                                    <span style="display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 10px; background: rgba(59,130,246,0.1); color: #3B82F6; font-size: 1rem;"><i class="fas fa-search"></i></span>
                                    <strong style="font-size: 0.95rem;">Recherche semantique</strong>
                                </div>
                                <p style="margin: 0; font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">Recherche en langage naturel dans vos fichiers grace au full-text search FTS5.</p>
                            </div>
                            <label class="toggle-switch" style="flex-shrink: 0; margin-top: 6px;">
                                <input type="checkbox" id="aiSvc_searchEnabled">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Albums intelligents -->
                    <div class="settings-card" style="margin: 0; padding: 20px;">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
                                    <span style="display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 10px; background: rgba(16,185,129,0.1); color: #10B981; font-size: 1rem;"><i class="fas fa-images"></i></span>
                                    <strong style="font-size: 0.95rem;">Albums intelligents</strong>
                                </div>
                                <p style="margin: 0; font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">Creation automatique d'albums selon des regles (type, date, tags, localisation).</p>
                            </div>
                            <label class="toggle-switch" style="flex-shrink: 0; margin-top: 6px;">
                                <input type="checkbox" id="aiSvc_smartAlbumsEnabled">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Timeline video -->
                    <div class="settings-card" style="margin: 0; padding: 20px;">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
                                    <span style="display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 10px; background: rgba(239,68,68,0.1); color: #EF4444; font-size: 1rem;"><i class="fas fa-film"></i></span>
                                    <strong style="font-size: 0.95rem;">Timeline video</strong>
                                </div>
                                <p style="margin: 0; font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">Analyse des videos : extraction de scenes cles, miniatures et chapitrage automatique.</p>
                            </div>
                            <label class="toggle-switch" style="flex-shrink: 0; margin-top: 6px;">
                                <input type="checkbox" id="aiSvc_videoTimelineEnabled">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Auto-analyse -->
                    <div class="settings-card" style="margin: 0; padding: 20px;">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
                                    <span style="display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 10px; background: rgba(99,102,241,0.1); color: #6366F1; font-size: 1rem;"><i class="fas fa-magic"></i></span>
                                    <strong style="font-size: 0.95rem;">Auto-analyse a l'upload</strong>
                                </div>
                                <p style="margin: 0; font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">Analyse automatique de chaque fichier des son upload (tags, description, GPS).</p>
                            </div>
                            <label class="toggle-switch" style="flex-shrink: 0; margin-top: 6px;">
                                <input type="checkbox" id="aiSvc_autoAnalyzeOnUpload">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Reverse geocoding -->
                    <div class="settings-card" style="margin: 0; padding: 20px;">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
                                    <span style="display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 10px; background: rgba(20,184,166,0.1); color: #14B8A6; font-size: 1rem;"><i class="fas fa-globe"></i></span>
                                    <strong style="font-size: 0.95rem;">Reverse geocoding</strong>
                                </div>
                                <p style="margin: 0; font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">Convertit les coordonnees GPS en adresses lisibles via Nominatim (OpenStreetMap).</p>
                            </div>
                            <label class="toggle-switch" style="flex-shrink: 0; margin-top: 6px;">
                                <input type="checkbox" id="aiSvc_reverseGeocodingEnabled">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                </div>

                <div style="margin-top: 20px; text-align: right;">
                    <button class="btn btn-primary" id="saveAIServicesBtn">
                        <i class="fas fa-save"></i> Enregistrer les services
                    </button>
                </div>
            </div>

            <!-- AI Parameters Sub-tab -->
            <div id="ai-params" class="ai-tab-content">
                <div class="settings-grid">
                    <div class="settings-card">
                        <h3><i class="fas fa-robot"></i> Modeles</h3>
                        <div class="settings-form">
                            <div class="form-group">
                                <label>Modele OpenAI</label>
                                <select id="aiParam_openaiModel">
                                    <option value="gpt-4o">GPT-4o</option>
                                    <option value="gpt-4o-mini">GPT-4o Mini</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Modele Whisper</label>
                                <select id="aiParam_whisperModel">
                                    <option value="whisper-1">Whisper-1</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Langue transcription</label>
                                <select id="aiParam_whisperLanguage">
                                    <option value="fr">Francais</option>
                                    <option value="en">English</option>
                                    <option value="es">Espanol</option>
                                    <option value="de">Deutsch</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="settings-card">
                        <h3><i class="fas fa-sliders"></i> Seuils et parametres</h3>
                        <div class="settings-form">
                            <div class="form-group">
                                <label>Confiance faciale min (0-1)</label>
                                <input type="number" id="aiParam_faceMinConfidence" step="0.05" min="0" max="1" value="0.7">
                            </div>
                            <div class="form-group">
                                <label>Intervalle frames video (sec)</label>
                                <input type="number" id="aiParam_videoFrameInterval" min="1" max="60" value="5">
                            </div>
                            <div class="form-group">
                                <label>Taille thumbnails (px)</label>
                                <input type="number" id="aiParam_thumbnailSize" min="50" max="800" value="300">
                            </div>
                            <div class="form-group">
                                <label>Qualite thumbnails (0-100)</label>
                                <input type="number" id="aiParam_thumbnailQuality" min="10" max="100" value="80">
                            </div>
                            <div class="form-group">
                                <label>Jobs simultanes max</label>
                                <input type="number" id="aiParam_maxConcurrentAnalysis" min="1" max="10" value="3">
                            </div>
                        </div>
                    </div>
                    <div class="settings-card">
                        <h3><i class="fas fa-wallet"></i> Budget IA</h3>
                        <div class="settings-form">
                            <div class="form-group">
                                <label>Budget mensuel ($)</label>
                                <input type="number" id="aiParam_aiMonthlyBudget" min="0" max="10000" value="50">
                            </div>
                            <div class="form-group">
                                <label>Seuil alerte (% du budget)</label>
                                <input type="number" id="aiParam_aiCostAlertThreshold" min="0" max="100" value="80">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings-actions">
                    <button class="btn btn-primary btn-large" id="saveAIParamsBtn">
                        <i class="fas fa-save"></i> Enregistrer les parametres IA
                    </button>
                </div>
            </div>

            <!-- AI Scans Sub-tab -->
            <div id="ai-scans" class="ai-tab-content">
                <div class="card">
                    <h3><i class="fas fa-radar"></i> Scans planifies</h3>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Planification</th>
                                    <th>Actif</th>
                                    <th>Derniere execution</th>
                                    <th>Statut</th>
                                    <th>Fichiers traites</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="aiScansTableBody">
                                <tr><td colspan="7" class="loading">Chargement...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-secondary" id="reindexBtn">
                        <i class="fas fa-sync"></i> Reindexer la recherche
                    </button>
                </div>
            </div>

            <!-- AI Map Sub-tab -->
            <div id="ai-map" class="ai-tab-content">
                <div class="card">
                    <h3><i class="fas fa-map-marked-alt"></i> Carte des fichiers geotagues</h3>
                    <div id="ai-map-container"></div>
                </div>
            </div>
        </section>

        <!-- Faces Section -->
        <section id="faces" class="content-section">
            <div class="section-toolbar">
                <div class="toolbar-actions">
                    <button class="btn btn-primary" id="createProfileBtn">
                        <i class="fas fa-plus"></i> Nouveau profil
                    </button>
                </div>
            </div>
            <div class="faces-tabs" style="display:flex;gap:8px;margin-bottom:20px;">
                <button class="btn btn-secondary active" id="tabProfiles" onclick="switchFaceTab('profiles')">üë§ Profils</button>
                <button class="btn btn-secondary" id="tabUnassigned" onclick="switchFaceTab('unassigned')">‚ùì Non identifies</button>
            </div>
            <div id="facesProfilesView">
                <div id="profilesGrid" class="faces-grid">
                    <p class="loading">Chargement...</p>
                </div>
            </div>
            <div id="facesUnassignedView" style="display:none;">
                <div id="unassignedGrid" class="faces-grid">
                    <p class="loading">Chargement...</p>
                </div>
            </div>
            <div class="modal-overlay" id="profileDetailModal" style="display:none;">
                <div class="modal-content" style="max-width:700px;">
                    <div class="modal-header">
                        <h3 id="profileDetailName">Profil</h3>
                        <button class="btn btn-icon" onclick="closeProfileDetail()"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="modal-body">
                        <div style="margin-bottom:16px;">
                            <label>Nom :</label>
                            <input type="text" id="profileNameInput" class="form-input" placeholder="Nom de la personne">
                            <button class="btn btn-primary btn-sm" onclick="saveProfileName()" style="margin-top:8px;">Enregistrer</button>
                        </div>
                        <h4>Photos (<span id="profilePhotoCount">0</span>)</h4>
                        <div id="profilePhotosGrid" class="faces-photos-grid"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Audit S√©curit√© Section -->
        <section id="audit" class="content-section" style="display:none;">
            <div id="auditEmptyBanner" style="background:#e3f2fd;border:1px solid #90caf9;border-radius:8px;padding:20px;margin-bottom:20px;text-align:center;">
                <i class="fas fa-shield-halved" style="font-size:2.5rem;color:#1565C0;margin-bottom:10px;display:block;"></i>
                <h3 style="margin:0 0 8px 0;color:#1565C0;">Audit de s√©curit√© actif ‚úÖ</h3>
                <p style="margin:0;color:#555;">Aucune activit√© √† auditer pour le moment. Les donn√©es appara√Ætront automatiquement d√®s que des fichiers seront upload√©s, partag√©s ou t√©l√©charg√©s.</p>
            </div>
            <div class="stats-grid" id="auditStats">
                <div class="stat-card">
                    <div class="stat-icon" style="background:#e3f2fd;"><i class="fas fa-share-nodes" style="color:#1565C0;"></i></div>
                    <div class="stat-info"><h3 id="auditActiveShares">0</h3><p>Partages actifs</p></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:#fff3e0;"><i class="fas fa-download" style="color:#e65100;"></i></div>
                    <div class="stat-info"><h3 id="auditTotalDownloads">0</h3><p>T√©l√©chargements</p></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:#fce4ec;"><i class="fas fa-lock-open" style="color:#c62828;"></i></div>
                    <div class="stat-info"><h3 id="auditNoPassword">0</h3><p>Sans mot de passe</p></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:#e8f5e9;"><i class="fas fa-clock" style="color:#2e7d32;"></i></div>
                    <div class="stat-info"><h3 id="auditExpired">0</h3><p>Expir√©s</p></div>
                </div>
            </div>
            <div style="display:flex;gap:8px;margin:20px 0;">
                <button class="btn btn-secondary active" id="auditTabShares" onclick="switchAuditTab('shares')">üì§ Partages actifs</button>
                <button class="btn btn-secondary" id="auditTabDownloads" onclick="switchAuditTab('downloads')">üì• T√©l√©chargements</button>
                <button class="btn btn-secondary" id="auditTabFiles" onclick="switchAuditTab('files')">üìÅ Fichiers</button>
            </div>
            <div id="auditSharesView">
                <div class="table-container"><table class="data-table"><thead><tr><th>Fichier</th><th>Cr√©√© par</th><th>Destinataire</th><th>Expire le</th><th>T√©l√©ch.</th><th>MDP</th><th>Actions</th></tr></thead><tbody id="auditSharesBody"></tbody></table></div>
            </div>
            <div id="auditDownloadsView" style="display:none;">
                <div class="table-container"><table class="data-table"><thead><tr><th>Fichier</th><th>Partag√© par</th><th>Destinataire</th><th>T√©l√©charg√© le</th><th>IP</th></tr></thead><tbody id="auditDownloadsBody"></tbody></table></div>
            </div>
            <div id="auditFilesView" style="display:none;">
                <div class="table-container"><table class="data-table"><thead><tr><th>Fichier</th><th>Propri√©taire</th><th>Taille</th><th>Upload√© le</th><th>Partages actifs</th></tr></thead><tbody id="auditFilesBody"></tbody></table></div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="content-section">

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- SOUS-SECTION : G√âN√âRAL              -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div style="margin-bottom: 32px;">
                <h2 style="font-size: 1.2rem; font-weight: 700; color: var(--text-primary, #1a1a2e); margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--primary-color, #0066CC); display: inline-block;">
                    <i class="fas fa-cog"></i> &nbsp;G√©n√©ral
                </h2>
                <div class="settings-grid">
                    <div class="settings-card">
                        <h3><i class="fas fa-database"></i> Configuration du Stockage</h3>
                        <div class="settings-form">
                            <div class="form-group">
                                <label>Taille maximale par fichier (MB)</label>
                                <input type="number" id="maxFileSizeMB" value="100" min="1" max="5000">
                            </div>
                            <div class="form-group">
                                <label>Nom du conteneur</label>
                                <input type="text" id="containerName" value="uploads" readonly>
                            </div>
                            <div class="form-group">
                                <label>Quota de stockage (GB)</label>
                                <input type="number" id="storageQuota" value="100" min="1" max="10000">
                            </div>
                        </div>
                    </div>
                    <div class="settings-card">
                        <h3><i class="fas fa-link"></i> Configuration du Partage</h3>
                        <div class="settings-form">
                            <div class="form-group">
                                <label>Duree maximale d'expiration (jours)</label>
                                <input type="number" id="maxShareDays" value="30" min="1" max="365">
                            </div>
                            <div class="form-group">
                                <label>Duree par defaut (minutes)</label>
                                <input type="number" id="defaultShareMinutes" value="60" min="15" max="43200">
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" id="requirePassword"> Exiger un mot de passe pour les partages</label>
                            </div>
                        </div>
                    </div>
                    <div class="settings-card">
                        <h3><i class="fas fa-bell"></i> Notifications</h3>
                        <div class="settings-form">
                            <div class="form-group">
                                <label><input type="checkbox" id="notifyUploads"> Notifier les nouveaux uploads</label>
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" id="notifyShares"> Notifier les nouveaux partages</label>
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" id="notifyQuota" checked> Alerter si quota depasse</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings-actions">
                    <button class="btn btn-primary btn-large" id="saveSettingsBtn">
                        <i class="fas fa-save"></i> Enregistrer les parametres
                    </button>
                    <button class="btn btn-secondary btn-large" id="resetSettingsBtn">
                        <i class="fas fa-undo"></i> Reinitialiser
                    </button>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- SOUS-SECTION : EMAIL (Multi-provider) -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div style="margin-bottom: 32px;">
                <h2 style="font-size: 1.2rem; font-weight: 700; color: var(--text-primary, #1a1a2e); margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid #ff5722; display: inline-block;">
                    <i class="fas fa-envelope" style="color: #ff5722;"></i> &nbsp;Email
                </h2>

                <!-- Provider selector -->
                <div class="settings-card" style="border-left: 4px solid #ff5722; margin-bottom: 16px;">
                    <h4>üìß Fournisseur d'email</h4>
                    <p style="color:#666;margin-bottom:12px;">Choisissez votre fournisseur pour l'envoi d'emails</p>
                    <select id="emailProvider" class="form-input" style="max-width:300px;" onchange="onEmailProviderChange()">
                        <option value="smtp">SMTP g√©n√©rique</option>
                        <option value="mailjet">Mailjet (API)</option>
                        <option value="sendgrid">SendGrid (API)</option>
                        <option value="brevo">Brevo (ex-Sendinblue)</option>
                        <option value="postmark">Postmark (API)</option>
                        <option value="sparkpost">SparkPost (API)</option>
                        <option value="mailgun">Mailgun (API)</option>
                        <option value="ses">Amazon SES</option>
                        <option value="ovh">OVH</option>
                        <option value="ionos">IONOS (1&1)</option>
                        <option value="gandi">Gandi</option>
                        <option value="infomaniak">Infomaniak</option>
                        <option value="gmail">Gmail</option>
                        <option value="yahoo">Yahoo</option>
                        <option value="outlook">Outlook / Office 365</option>
                        <option value="zoho">Zoho Mail</option>
                        <option value="protonmail">ProtonMail Bridge</option>
                        <option value="free">Free (Freebox)</option>
                        <option value="orange">Orange</option>
                        <option value="sfr">SFR</option>
                        <option value="laposte">La Poste</option>
                    </select>
                </div>

                <!-- Onglets -->
                <div style="display:flex;gap:4px;margin-bottom:0;">
                    <button class="btn btn-secondary emailTab" onclick="showEmailTab('smtp')" id="emailTabSmtp" style="border-bottom-left-radius:0;border-bottom-right-radius:0;">üì§ Envoi SMTP</button>
                    <button class="btn btn-secondary emailTab" onclick="showEmailTab('mailjet')" id="emailTabMailjet" style="border-bottom-left-radius:0;border-bottom-right-radius:0;">üöÄ Mailjet API</button>
                </div>

                <!-- SMTP Config -->
                <div id="emailPanelSmtp" class="settings-card" style="border-left: 4px solid #ff5722; border-top-left-radius:0;">
                    <h4>üì§ Configuration SMTP</h4>
                    <p style="color:#666;margin-bottom:16px;">Param√®tres du serveur SMTP pour l'envoi d'emails</p>
                    
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                        <div>
                            <label>Serveur SMTP</label>
                            <input type="text" id="smtpHost" class="form-input" placeholder="smtp.example.com">
                        </div>
                        <div>
                            <label>Port</label>
                            <input type="number" id="smtpPort" class="form-input" placeholder="465">
                        </div>
                        <div>
                            <label>Utilisateur</label>
                            <input type="text" id="smtpUser" class="form-input" placeholder="votre@example.com">
                        </div>
                        <div>
                            <label>Mot de passe</label>
                            <input type="password" id="smtpPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <div>
                            <label>Email exp√©diteur</label>
                            <input type="email" id="smtpFromEmail" class="form-input" placeholder="noreply@shareazure.com">
                        </div>
                        <div>
                            <label>Nom exp√©diteur</label>
                            <input type="text" id="smtpFromName" class="form-input" placeholder="ShareAzure">
                        </div>
                    </div>
                    
                    <div style="margin-top:12px;display:flex;align-items:center;gap:8px;">
                        <input type="checkbox" id="smtpSecure">
                        <label for="smtpSecure">Connexion s√©curis√©e (SSL/TLS)</label>
                    </div>
                    <div style="margin-top:8px;display:flex;align-items:center;gap:8px;">
                        <input type="checkbox" id="emailEnabled">
                        <label for="emailEnabled">Activer l'envoi d'emails</label>
                    </div>
                    
                    <div style="margin-top:16px;display:flex;gap:8px;flex-wrap:wrap;">
                        <button class="btn btn-primary" onclick="saveEmailConfig()">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                        <button class="btn btn-secondary" onclick="testEmailConnection()">
                            <i class="fas fa-plug"></i> Tester la connexion
                        </button>
                        <button class="btn btn-secondary" onclick="sendTestEmail()">
                            <i class="fas fa-paper-plane"></i> Envoyer un test
                        </button>
                    </div>
                    <div id="emailTestResult" style="margin-top:8px;"></div>
                </div>

                <!-- Mailjet Config -->
                <div id="emailPanelMailjet" class="settings-card" style="border-left: 4px solid #ff5722; display:none; border-top-left-radius:0;">
                    <h4>üöÄ Configuration Mailjet (API)</h4>
                    <p style="color:#666;margin-bottom:16px;">Utilisez l'API Mailjet pour l'envoi d'emails (sans SMTP)</p>
                    
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                        <div>
                            <label>Cl√© API (API Key)</label>
                            <input type="text" id="mailjetApiKey" class="form-input" placeholder="votre-cle-api">
                        </div>
                        <div>
                            <label>Cl√© secr√®te (Secret Key)</label>
                            <input type="password" id="mailjetSecretKey" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <div>
                            <label>Email exp√©diteur</label>
                            <input type="email" id="mailjetFromEmail" class="form-input" placeholder="noreply@shareazure.com">
                        </div>
                        <div>
                            <label>Nom exp√©diteur</label>
                            <input type="text" id="mailjetFromName" class="form-input" placeholder="ShareAzure">
                        </div>
                    </div>
                    
                    <div style="margin-top:12px;display:flex;align-items:center;gap:8px;">
                        <input type="checkbox" id="mailjetEnabled">
                        <label for="mailjetEnabled">Activer l'envoi via Mailjet</label>
                    </div>
                    
                    <div style="margin-top:16px;display:flex;gap:8px;flex-wrap:wrap;">
                        <button class="btn btn-primary" onclick="saveMailjetConfig()">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                        <button class="btn btn-secondary" onclick="testMailjetConnection()">
                            <i class="fas fa-plug"></i> Tester la connexion
                        </button>
                        <button class="btn btn-secondary" onclick="sendTestEmail()">
                            <i class="fas fa-paper-plane"></i> Envoyer un test
                        </button>
                    </div>
                    <div id="mailjetTestResult" style="margin-top:8px;"></div>
                </div>

            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- SOUS-SECTION : S√âCURIT√â             -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div style="margin-bottom: 32px;">
                <h2 style="font-size: 1.2rem; font-weight: 700; color: var(--text-primary, #1a1a2e); margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid #EF4444; display: inline-block;">
                    <i class="fas fa-shield-alt" style="color: #EF4444;"></i> &nbsp;S√©curit√©
                </h2>

                <!-- Logs de s√©curit√© ‚Äî pleine largeur -->
                <div class="settings-card" style="margin-bottom: 16px;">
                    <h3><i class="fas fa-shield-halved"></i> Logs de s√©curit√©</h3>
                    <div class="settings-form">
                        <div class="form-group">
                            <label>Rate limiting (requetes par 15 min)</label>
                            <input type="number" id="rateLimit" value="100" min="10" max="1000">
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="enableLogs" checked> Activer les logs detailles</label>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="enableAudit" checked> Activer l'audit trail</label>
                        </div>
                    </div>
                </div>

                <!-- Antivirus ClamAV -->
                <div class="settings-card" style="margin-bottom: 16px;">
                    <h3><i class="fas fa-shield-virus"></i> üõ°Ô∏è Antivirus ClamAV</h3>
                    <div class="settings-form">
                        <div class="form-group">
                            <label><input type="checkbox" id="virusScanEnabled" checked> Activer le scan antivirus</label>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="virusScanOnUpload" checked> Scanner automatiquement √† l'upload</label>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="virusQuarantineNotifyAdmin" checked> Notifier l'admin en cas de menace</label>
                        </div>
                        <div id="virusScanStats" style="margin-top: 12px; padding: 12px; background: var(--bg-tertiary, #f0f0f5); border-radius: 8px; font-size: 0.9rem;">
                            <p><strong>Statut :</strong> <span id="clamAvStatus">Chargement...</span></p>
                            <p><strong>Menaces d√©tect√©es :</strong> <span id="virusThreatsCount">-</span></p>
                            <p><strong>En quarantaine :</strong> <span id="virusPendingCount">-</span></p>
                        </div>
                    </div>

                    <!-- Quarantaine -->
                    <div style="margin-top: 16px;">
                        <h4 style="margin-bottom: 8px;"><i class="fas fa-biohazard"></i> Fichiers en quarantaine</h4>
                        <div id="quarantineList" style="max-height: 300px; overflow-y: auto;">
                            <p style="color: #888; font-size: 0.9rem;">Chargement...</p>
                        </div>
                    </div>
                </div>

                <!-- Domaines d'emails autoris√©s ‚Äî pleine largeur -->
                <div class="settings-card" style="margin-bottom: 16px;">
                    <h3><i class="fas fa-envelope"></i> Domaines d'emails autoris√©s</h3>
                    <div class="settings-form">
                        <div class="form-group">
                            <label>Ajouter un domaine</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="newEmailDomainInput" class="form-input" placeholder="exemple.com" style="flex: 1;">
                                <button class="btn btn-primary" id="addEmailDomainBtn">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                                <button class="btn btn-secondary" id="importEmailDomainsBtn">
                                    <i class="fas fa-file-import"></i> Importer
                                </button>
                                <input type="file" id="importEmailDomainsFile" accept=".txt,.csv" style="display: none;">
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <div class="table-container">
                            <table class="data-table" id="emailDomainsTable">
                                <thead>
                                    <tr>
                                        <th>Domaine</th>
                                        <th>Cr√©ation</th>
                                        <th>S√©curit√©</th>
                                        <th>Statut</th>
                                        <th>Date d'ajout</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="emailDomainsTableBody">
                                    <tr><td colspan="6" class="loading">Chargement des domaines...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div id="emailDomainsPagination" class="domains-pagination" style="display: none;">
                            <span id="domainsCount" class="domains-page-info"></span>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <button class="btn btn-secondary btn-small" id="domainsPrevBtn" disabled>
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span id="domainsPageInfo" class="domains-page-info"></span>
                                <button class="btn btn-secondary btn-small" id="domainsNextBtn" disabled>
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- R√¥les & Permissions -->
                <div class="settings-card" style="border-left: 4px solid #ff9800; margin-bottom: 16px;">
                    <h3><i class="fas fa-user-shield" style="color: #ff9800;"></i> üé≠ R√¥les & Permissions</h3>
                    <p style="color:#666;margin-bottom:16px;">Configurez les droits accord√©s √† chaque r√¥le</p>
                    <div class="table-container">
                        <table id="permissionsMatrix" class="data-table">
                            <thead>
                                <tr>
                                    <th>Permission</th>
                                    <th style="text-align:center">Admin</th>
                                    <th style="text-align:center">COM</th>
                                    <th style="text-align:center">Utilisateur</th>
                                    <th style="text-align:center">Lecteur</th>
                                </tr>
                            </thead>
                            <tbody id="permissionsMatrixBody">
                                <!-- Filled by JS -->
                            </tbody>
                        </table>
                    </div>
                    <button class="btn btn-primary" onclick="savePermissions()" style="margin-top:12px;">
                        <i class="fas fa-save"></i> Enregistrer les permissions
                    </button>
                </div>

                <!-- Authentification ‚Äî pleine largeur -->
                <div class="settings-card">
                    <h3><i class="fas fa-key"></i> Authentification</h3>
                    <div class="settings-form">
                        <div class="form-group">
                            <label>Mode d'authentification</label>
                            <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 4px;">
                                <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="radio" name="authMode" value="local" id="authModeLocal" checked>
                                    <span><strong>Local uniquement</strong> ‚Äî comptes locaux avec mot de passe</span>
                                </label>
                                <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="radio" name="authMode" value="entra" id="authModeEntra">
                                    <span><strong>Azure Entra ID (SSO)</strong> ‚Äî authentification Microsoft</span>
                                </label>
                                <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="radio" name="authMode" value="hybrid" id="authModeHybrid">
                                    <span><strong>Hybride</strong> ‚Äî local + Entra</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div id="entraConfigSection" style="display: none; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color, #e0e0e0);">
                        <h4 style="margin-bottom: 12px; color: var(--primary-color, #003C61);"><i class="fab fa-microsoft"></i> Configuration Azure Entra</h4>
                        <div class="settings-form">
                            <div class="form-group">
                                <label>Tenant ID</label>
                                <input type="text" id="entraTenantId" placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx">
                            </div>
                            <div class="form-group">
                                <label>Client ID</label>
                                <input type="text" id="entraClientId" placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx">
                            </div>
                            <div class="form-group">
                                <label>Client Secret</label>
                                <input type="password" id="entraClientSecret" placeholder="Laisser vide pour ne pas modifier">
                            </div>
                            <div class="form-group">
                                <label>Redirect URI</label>
                                <input type="text" id="entraRedirectUri" placeholder="https://votre-domaine/api/auth/callback">
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 12px;">
                            <button class="btn btn-secondary" id="testEntraBtn">
                                <i class="fas fa-plug"></i> Tester la connexion
                            </button>
                        </div>
                        <div id="entraTestResult" style="display: none; margin-top: 10px; padding: 10px; border-radius: 8px;"></div>
                    </div>
                    <div style="margin-top: 12px;">
                        <button class="btn btn-primary" id="saveAuthSettingsBtn">
                            <i class="fas fa-save"></i> Enregistrer l'authentification
                        </button>
                    </div>
                </div>

                <!-- Mapping Groupes Entra ‚Üí R√¥les -->
                <div class="settings-card" style="border-left: 4px solid #0078d4; margin-top: 16px;">
                    <h4 style="margin-bottom: 4px;"><i class="fab fa-microsoft" style="color: #0078d4;"></i> üîó Mapping Groupes Entra ID ‚Üí R√¥les</h4>
                    <p style="color:#666;margin-bottom:16px;">Associez les groupes Azure AD aux r√¥les ShareAzure. Les r√¥les sont synchronis√©s automatiquement √† chaque connexion SSO.</p>

                    <div style="display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="entraGroupSyncEnabled" checked>
                            <span>Synchroniser les r√¥les √† la connexion</span>
                        </label>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <label>R√¥le par d√©faut :</label>
                            <select id="entraDefaultRole" class="filter-select" style="width: auto;">
                                <option value="viewer">Lecteur</option>
                                <option value="user">Utilisateur</option>
                                <option value="com">COM</option>
                            </select>
                        </div>
                        <button class="btn btn-secondary btn-small" id="saveEntraSyncSettingsBtn">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                    </div>

                    <table class="data-table" id="entraMappingsTable">
                        <thead>
                            <tr>
                                <th>R√¥le ShareAzure</th>
                                <th>Group ID Entra</th>
                                <th>Nom du groupe</th>
                                <th>Priorit√©</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="entraMappingsBody">
                            <tr><td colspan="5" class="loading">Chargement...</td></tr>
                        </tbody>
                    </table>
                    <p style="color:#888;font-size:0.85rem;margin-top:8px;">
                        <i class="fas fa-info-circle"></i> Si un utilisateur appartient √† plusieurs groupes, le r√¥le avec la priorit√© la plus √©lev√©e est attribu√©.
                        Les utilisateurs sans groupe correspondant re√ßoivent le r√¥le par d√©faut configur√© ci-dessus.
                    </p>
                    <div style="margin-top: 12px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-secondary btn-small" id="fetchEntraGroupsBtn">
                            <i class="fab fa-microsoft"></i> Charger les groupes depuis Entra
                        </button>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="email" id="testMappingEmail" placeholder="email@example.com" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.85rem;">
                            <button class="btn btn-secondary btn-small" id="testMappingBtn">
                                <i class="fas fa-flask"></i> Tester
                            </button>
                        </div>
                    </div>
                    <div id="testMappingResult" style="display: none; margin-top: 10px; padding: 10px; border-radius: 8px; font-size: 0.9rem;"></div>
                    <div id="entraGroupsList" style="display: none; margin-top: 10px; padding: 10px; background: var(--bg-tertiary, #f5f5f5); border-radius: 8px; max-height: 200px; overflow-y: auto; font-size: 0.85rem;"></div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- SOUS-SECTION : QUOTAS               -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div style="margin-bottom: 32px; margin-top: 32px;">
                <h2 style="font-size: 1.2rem; font-weight: 700; color: var(--text-primary, #1a1a2e); margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--primary-color, #0066CC); display: inline-block;">
                    <i class="fas fa-tachometer-alt"></i> &nbsp;Quotas
                </h2>

                <!-- Quotas par d√©faut -->
                <div class="settings-card" style="margin-bottom: 20px; padding: 20px;">
                    <h3><i class="fas fa-sliders-h"></i> Quotas par d√©faut (utilisateurs sans √©quipe)</h3>
                    <div class="settings-form">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                            <div class="form-group">
                                <label>Stockage max (Go)</label>
                                <input type="number" id="defaultMaxStorageGb" step="0.5" min="0.1">
                            </div>
                            <div class="form-group">
                                <label>Fichiers max</label>
                                <input type="number" id="defaultMaxFiles" min="1">
                            </div>
                            <div class="form-group">
                                <label>Taille max par fichier (Mo)</label>
                                <input type="number" id="defaultMaxFileSizeMb" step="1" min="1">
                            </div>
                            <div class="form-group">
                                <label>Partages max par utilisateur</label>
                                <input type="number" id="defaultMaxSharesPerUser" min="1">
                            </div>
                            <div class="form-group">
                                <label>Dur√©e max de partage (jours)</label>
                                <input type="number" id="defaultMaxShareDurationDays" min="1">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="saveDefaultQuotas()" style="margin-top: 12px;">
                            <i class="fas fa-save"></i> Enregistrer les quotas par d√©faut
                        </button>
                    </div>
                </div>

                <!-- Quotas par √©quipe -->
                <div class="settings-card" style="padding: 20px;">
                    <h3><i class="fas fa-users-cog"></i> Quotas par √©quipe</h3>
                    <div id="teamQuotasTable" style="margin-top: 12px;">
                        <p style="color: #666;"><i class="fas fa-spinner fa-spin"></i> Chargement...</p>
                    </div>
                </div>

                <!-- Modal √©dition quota √©quipe -->
                <div id="editQuotaModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:9999; align-items:center; justify-content:center;">
                    <div style="background:white; border-radius:12px; padding:24px; max-width:500px; width:90%; margin:auto; margin-top:10vh;">
                        <h3 style="margin-bottom:16px; color:#003C61;"><i class="fas fa-edit"></i> Modifier les quotas ‚Äî <span id="editQuotaTeamName"></span></h3>
                        <input type="hidden" id="editQuotaTeamId">
                        <div style="display:grid; gap:12px;">
                            <div class="form-group">
                                <label>Stockage max (Go)</label>
                                <input type="number" id="editMaxStorageGb" step="0.5" min="0.1">
                            </div>
                            <div class="form-group">
                                <label>Fichiers max</label>
                                <input type="number" id="editMaxFiles" min="1">
                            </div>
                            <div class="form-group">
                                <label>Taille max par fichier (Mo)</label>
                                <input type="number" id="editMaxFileSizeMb" step="1" min="1">
                            </div>
                            <div class="form-group">
                                <label>Partages max par utilisateur</label>
                                <input type="number" id="editMaxSharesPerUser" min="1">
                            </div>
                            <div class="form-group">
                                <label>Dur√©e max de partage (jours)</label>
                                <input type="number" id="editMaxShareDurationDays" min="1">
                            </div>
                        </div>
                        <div style="display:flex; gap:10px; margin-top:16px; justify-content:flex-end;">
                            <button class="btn btn-secondary" onclick="closeQuotaModal()">Annuler</button>
                            <button class="btn btn-primary" onclick="saveTeamQuota()"><i class="fas fa-save"></i> Enregistrer</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- SOUS-SECTION : TIERING AUTOMATIQUE -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div style="margin-bottom: 32px;">
                <h2 style="font-size: 1.2rem; font-weight: 700; color: var(--text-primary, #1a1a2e); margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid #4CAF50; display: inline-block;">
                    <i class="fas fa-layer-group" style="color: #4CAF50;"></i> &nbsp;Tiering automatique
                </h2>

                <!-- Politique globale -->
                <div class="settings-card" style="border-left: 4px solid #4CAF50; margin-bottom: 16px;">
                    <h4>üåç Politique globale</h4>
                    <p style="color:#666;margin-bottom:12px;">D√©placement automatique des fichiers entre les niveaux de stockage Azure</p>
                    <div style="display:grid;grid-template-columns:1fr 1fr auto;gap:12px;align-items:end;">
                        <div class="form-group" style="margin-bottom:0;">
                            <label>Passage Hot ‚Üí Cool apr√®s (jours)</label>
                            <input type="number" id="tieringHotToCool" class="form-input" value="30" min="1">
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <label>Passage Cool ‚Üí Archive apr√®s (jours)</label>
                            <input type="number" id="tieringCoolToArchive" class="form-input" value="90" min="1">
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <label style="display:flex;align-items:center;gap:8px;">
                                <input type="checkbox" id="tieringEnabled"> Activ√©
                            </label>
                        </div>
                    </div>
                    <div style="margin-top:12px;display:flex;gap:8px;">
                        <button class="btn btn-primary" onclick="saveTieringGlobal()"><i class="fas fa-save"></i> Enregistrer</button>
                        <button class="btn btn-secondary" onclick="previewTiering()"><i class="fas fa-eye"></i> Pr√©visualiser</button>
                        <button class="btn btn-warning" onclick="runTiering()" style="background:#ff9800;color:#fff;border:none;"><i class="fas fa-play"></i> Ex√©cuter maintenant</button>
                    </div>
                </div>

                <!-- Surcharges par √©quipe -->
                <div class="settings-card" style="border-left: 4px solid #4CAF50; margin-bottom: 16px;">
                    <h4>üë• Surcharges par √©quipe</h4>
                    <p style="color:#666;margin-bottom:12px;">Les politiques par √©quipe remplacent la politique globale</p>
                    <div id="tieringTeamOverrides">
                        <p style="color:#999;">Chargement...</p>
                    </div>
                    <div style="margin-top:12px;display:flex;gap:8px;align-items:center;">
                        <select id="tieringTeamSelect" class="form-input" style="max-width:200px;">
                            <option value="">-- Choisir une √©quipe --</option>
                        </select>
                        <button class="btn btn-secondary" onclick="addTieringTeamOverride()"><i class="fas fa-plus"></i> Ajouter une √©quipe</button>
                    </div>
                </div>

                <!-- Pr√©visualisation -->
                <div class="settings-card" style="border-left: 4px solid #4CAF50; display:none;" id="tieringPreviewCard">
                    <h4>üëÅÔ∏è Pr√©visualisation du tiering</h4>
                    <div id="tieringPreviewContent"></div>
                </div>
            </div>

        </section>
    </main>

    <!-- Modals -->

    <!-- File Details Modal -->
    <div class="modal" id="fileDetailsModal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3><i class="fas fa-file"></i> Details du fichier</h3>
                <button class="btn btn-close" id="closeFileDetailsBtn">&times;</button>
            </div>
            <div class="modal-body" id="fileDetailsBody"></div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal" style="display: none;">
        <div class="modal-content confirm-dialog">
            <div class="modal-header">
                <h3 id="confirmTitle">Confirmer l'action</h3>
            </div>
            <div class="modal-body confirm-body">
                <div class="confirm-icon">&#9888;</div>
                <p id="confirmMessage">Etes-vous sur de vouloir effectuer cette action ?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="confirmNoBtn">Annuler</button>
                <button class="btn btn-danger" id="confirmYesBtn">Confirmer</button>
            </div>
        </div>
    </div>

    <!-- Create Guest Modal -->
    <div class="modal" id="createGuestModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Creer un compte invite</h3>
                <button class="btn btn-close" id="closeCreateGuestBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createGuestForm">
                    <div class="form-group">
                        <label><i class="fas fa-envelope"></i> Email de l'invite</label>
                        <input type="email" id="guestEmail" name="email" required placeholder="invite@example.com" autocomplete="email">
                        <small style="color: var(--text-secondary);">Un code de verification sera envoye a cette adresse</small>
                    </div>
                    <div id="createGuestError" class="error-message" style="display: none; margin-top: 1rem; background: #FEE2E2; border: 1px solid #DC2626; border-radius: 8px; padding: 0.75rem;">
                        <i class="fas fa-exclamation-triangle" style="color: #DC2626;"></i>
                        <span id="createGuestErrorMessage"></span>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="submitCreateGuestBtn">
                    <i class="fas fa-paper-plane"></i> Creer et envoyer le code
                </button>
                <button class="btn btn-secondary" id="cancelCreateGuestBtn">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Guest Details Modal -->
    <div class="modal" id="guestDetailsModal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3><i class="fas fa-user-clock"></i> Details de l'invite</h3>
                <button class="btn btn-close" id="closeGuestDetailsBtn">&times;</button>
            </div>
            <div class="modal-body" id="guestDetailsBody"></div>
        </div>
    </div>

    <!-- Create Team Modal -->
    <div class="modal" id="createTeamModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-users-gear"></i> Creer une equipe</h3>
                <button class="btn btn-close" id="closeCreateTeamBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nom technique *</label>
                    <input type="text" id="teamName" placeholder="backend" required>
                    <small style="color: var(--text-secondary);">Minuscules, chiffres et tirets uniquement</small>
                </div>
                <div class="form-group">
                    <label>Nom affiche *</label>
                    <input type="text" id="teamDisplayName" placeholder="Equipe Backend" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="teamDescription" rows="3" placeholder="Description de l'equipe..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="submitCreateTeam">
                    <i class="fas fa-plus"></i> Creer
                </button>
                <button class="btn btn-secondary" id="cancelCreateTeamBtn">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Create User Modal -->
    <div class="modal" id="createUserModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Creer un utilisateur</h3>
                <button class="btn btn-close" id="closeCreateUserBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nom d'utilisateur *</label>
                    <input type="text" id="newUserUsername" placeholder="jean.dupont" required>
                </div>
                <div class="form-group">
                    <label>Nom complet</label>
                    <input type="text" id="newUserFullName" placeholder="Jean Dupont">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="newUserEmail" placeholder="jean@example.com">
                </div>
                <div class="form-group">
                    <label>Mot de passe *</label>
                    <input type="password" id="newUserPassword" placeholder="Mot de passe" required>
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select id="newUserRole" class="filter-select" style="width: 100%;">
                        <option value="user">Utilisateur</option>
                        <option value="com">Communication (COM)</option>
                        <option value="viewer">Lecteur</option>
                        <option value="admin">Administrateur</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="submitCreateUser">
                    <i class="fas fa-plus"></i> Creer
                </button>
                <button class="btn btn-secondary" id="cancelCreateUserBtn">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal" id="editUserModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-edit"></i> Modifier l'utilisateur</h3>
                <button class="btn btn-close" id="closeEditUserBtn">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editUserId">
                <div class="form-group">
                    <label>Nom d'utilisateur</label>
                    <input type="text" id="editUserUsername" disabled style="opacity: 0.6;">
                </div>
                <div class="form-group">
                    <label>Nom complet</label>
                    <input type="text" id="editUserFullName" placeholder="Nom complet">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="text" id="editUserEmail" disabled style="opacity: 0.6;">
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select id="editUserRole" class="filter-select" style="width: 100%;">
                        <option value="user">Utilisateur</option>
                        <option value="com">Communication (COM)</option>
                        <option value="viewer">Lecteur</option>
                        <option value="admin">Administrateur</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="submitEditUser">
                    <i class="fas fa-save"></i> Enregistrer
                </button>
                <button class="btn btn-secondary" id="cancelEditUserBtn">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div class="modal" id="resetPasswordModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Reinitialiser le mot de passe</h3>
                <button class="btn btn-close" id="closeResetPasswordBtn">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="resetPasswordUserId">
                <p style="margin-bottom: 16px; color: var(--text-secondary);">
                    Utilisateur: <strong id="resetPasswordUsername" style="color: var(--text-primary);"></strong>
                </p>
                <div class="form-group">
                    <label>Nouveau mot de passe *</label>
                    <input type="password" id="resetPasswordInput" placeholder="Nouveau mot de passe" required>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="submitResetPassword">
                    <i class="fas fa-key"></i> Reinitialiser
                </button>
                <button class="btn btn-secondary" id="cancelResetPasswordBtn">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Modal Gestion equipes d'un utilisateur -->
    <div class="modal" id="userTeamsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="userTeamsTitle">Equipes de l'utilisateur</h3>
                <button class="modal-close" id="closeUserTeamsBtn">&times;</button>
            </div>
            <div class="modal-body" id="userTeamsBody">
                <p class="loading">Chargement...</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelUserTeamsBtn">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Modal Details equipe -->
    <div class="modal" id="teamDetailModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 id="teamDetailTitle">Details equipe</h3>
                <button class="modal-close" id="closeTeamDetailBtn">&times;</button>
            </div>
            <div class="modal-body" id="teamDetailBody">
                <p class="loading">Chargement...</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelTeamDetailBtn">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div id="adminPreviewOverlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:9999;display:none;align-items:center;justify-content:center;" onclick="if(event.target===this)closeAdminPreview()">
        <div style="background:#1a1a1a;width:95vw;max-width:1200px;height:90vh;border-radius:12px;display:flex;flex-direction:column;overflow:hidden;">
            <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 20px;background:#222;border-bottom:1px solid #333;">
                <span id="adminPreviewTitle" style="color:#fff;font-weight:600;font-size:0.95rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;"></span>
                <button onclick="closeAdminPreview()" style="color:#ccc;background:transparent;border:none;font-size:1.2rem;cursor:pointer;padding:6px 10px;border-radius:6px;">‚úï</button>
            </div>
            <div id="adminPreviewBody" style="flex:1;display:flex;align-items:center;justify-content:center;overflow:auto;padding:20px;"></div>
        </div>
    </div>

    <script src="js/admin.js?v=20260218c"></script>
</body>
</html>
