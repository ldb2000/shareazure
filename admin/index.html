<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShareAzure - Administration</title>
    <link rel="stylesheet" href="css/admin.css">
    <!-- Font Awesome pour les icônes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js pour les graphiques -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Leaflet.js pour la carte -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <svg class="sidebar-logo" viewBox="0 0 559 165" xmlns="http://www.w3.org/2000/svg">
                <g fill-rule="evenodd">
                    <path d="M58.5905 90.33H89.6405C74.3705 56.31 40.2205 34.02 0.560547 34.02V102.78C0.560547 117.89 12.9605 130.43 28.2105 129.97H65.9906C61.0006 120.61 58.5905 109.53 58.5905 97.79V90.33Z" fill="#639E30"/>
                    <path d="M133.171 164.02C96.971 164.02 68.041 135.72 68.041 99.8H105.101C120.491 99.8 133.181 112.34 133.181 127.88V164.02H133.171Z" fill="#F8AA36"/>
                </g>
            </svg>
            <p class="sidebar-subtitle">Administration</p>
        </div>

        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-item active" data-section="dashboard">
                <i class="fas fa-chart-line nav-icon"></i>
                <span class="nav-text">Dashboard</span>
            </a>
            <a href="#files" class="nav-item" data-section="files">
                <i class="fas fa-folder-open nav-icon"></i>
                <span class="nav-text">Fichiers</span>
            </a>
            <a href="#shares" class="nav-item" data-section="shares">
                <i class="fas fa-share-nodes nav-icon"></i>
                <span class="nav-text">Partages</span>
            </a>
            <a href="#teams" class="nav-item" data-section="teams">
                <i class="fas fa-users-gear nav-icon"></i>
                <span class="nav-text">Equipes</span>
            </a>
            <a href="#costs" class="nav-item" data-section="costs">
                <i class="fas fa-dollar-sign nav-icon"></i>
                <span class="nav-text">Couts</span>
            </a>
            <a href="#users" class="nav-item" data-section="users">
                <i class="fas fa-users nav-icon"></i>
                <span class="nav-text">Utilisateurs</span>
            </a>
            <a href="#guests" class="nav-item" data-section="guests">
                <i class="fas fa-user-clock nav-icon"></i>
                <span class="nav-text">Invites</span>
            </a>
            <a href="#logs" class="nav-item" data-section="logs">
                <i class="fas fa-list-ul nav-icon"></i>
                <span class="nav-text">Logs</span>
            </a>
            <a href="#ai" class="nav-item" data-section="ai">
                <i class="fas fa-brain nav-icon"></i>
                <span class="nav-text">IA</span>
            </a>
            <a href="#settings" class="nav-item" data-section="settings">
                <i class="fas fa-cog nav-icon"></i>
                <span class="nav-text">Parametres</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="btn btn-secondary btn-small btn-block" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                Deconnexion
            </button>
            <p class="version">v3.0.0</p>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="top-header">
            <div class="header-left">
                <h2 id="pageTitle">Dashboard</h2>
                <p id="pageSubtitle">Vue d'ensemble de l'activite</p>
            </div>
            <div class="header-right">
                <button class="btn btn-icon" id="refreshBtn" title="Rafraichir">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <div class="user-menu">
                    <img src="https://ui-avatars.com/api/?name=Admin&background=003C61&color=fff" alt="Admin" class="user-avatar">
                    <span class="user-name" id="currentUserName">Admin</span>
                </div>
            </div>
        </header>

        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section active">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon stat-icon-blue">
                        <i class="fas fa-folder-open"></i>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Total Fichiers</p>
                        <h3 class="stat-value" id="statTotalFiles">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-icon-green">
                        <i class="fas fa-users-gear"></i>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Equipes</p>
                        <h3 class="stat-value" id="statTotalTeams">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-icon-orange">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Utilisateurs</p>
                        <h3 class="stat-value" id="statTotalUsers">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-icon-red">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Couts ce mois</p>
                        <h3 class="stat-value" id="statTotalCosts">$0.00</h3>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="charts-row">
                <div class="chart-card">
                    <h3><i class="fas fa-chart-line"></i> Uploads par jour (7 derniers jours)</h3>
                    <canvas id="uploadsChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3><i class="fas fa-chart-pie"></i> Types de fichiers</h3>
                    <canvas id="fileTypesChart"></canvas>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="activity-card">
                <h3><i class="fas fa-clock"></i> Activite recente</h3>
                <div class="activity-list" id="recentActivity">
                    <p class="loading">Chargement...</p>
                </div>
            </div>
        </section>

        <!-- Files Section -->
        <section id="files" class="content-section">
            <div class="section-toolbar">
                <div class="search-box">
                    <input type="text" id="fileSearchInput" placeholder="Rechercher un fichier...">
                </div>
                <div class="toolbar-actions">
                    <select id="fileTypeFilter" class="filter-select">
                        <option value="">Tous les types</option>
                        <option value="Images">Images</option>
                        <option value="PDF">PDF</option>
                        <option value="Vidéos">Videos</option>
                        <option value="Audio">Audio</option>
                        <option value="Documents">Documents</option>
                        <option value="Autres">Autres</option>
                    </select>
                    <select id="fileSortBy" class="filter-select">
                        <option value="date-desc">Plus recent</option>
                        <option value="date-asc">Plus ancien</option>
                        <option value="size-desc">Plus volumineux</option>
                        <option value="size-asc">Plus leger</option>
                        <option value="name-asc">Nom (A-Z)</option>
                        <option value="name-desc">Nom (Z-A)</option>
                    </select>
                    <button class="btn btn-danger" id="deleteSelectedBtn" disabled>
                        <i class="fas fa-trash"></i> Supprimer selection
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table" id="filesTable">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAllFiles"></th>
                            <th>Nom</th>
                            <th>Type</th>
                            <th>Taille</th>
                            <th>Date d'upload</th>
                            <th>Partages</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="filesTableBody">
                        <tr><td colspan="7" class="loading">Chargement des fichiers...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Shares Section -->
        <section id="shares" class="content-section">
            <div class="section-toolbar">
                <div class="search-box">
                    <input type="text" id="shareSearchInput" placeholder="Rechercher un partage...">
                </div>
                <div class="toolbar-actions">
                    <select id="shareStatusFilter" class="filter-select">
                        <option value="">Tous les statuts</option>
                        <option value="active">Actifs</option>
                        <option value="expired">Expires</option>
                    </select>
                    <button class="btn btn-primary" id="exportSharesBtn">
                        <i class="fas fa-download"></i> Exporter CSV
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table" id="sharesTable">
                    <thead>
                        <tr>
                            <th>Fichier</th>
                            <th>Cree le</th>
                            <th>Expire le</th>
                            <th>Statut</th>
                            <th>Telechargements</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="sharesTableBody">
                        <tr><td colspan="6" class="loading">Chargement des partages...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Teams Section -->
        <section id="teams" class="content-section">
            <div class="section-toolbar">
                <h3 style="margin: 0;">Gestion des Equipes</h3>
                <div class="toolbar-actions">
                    <button class="btn btn-primary" id="createTeamBtn">
                        <i class="fas fa-plus"></i> Creer une equipe
                    </button>
                </div>
            </div>
            <div class="table-container" id="teamsList">
                <p class="loading">Chargement...</p>
            </div>
        </section>

        <!-- Costs Section -->
        <section id="costs" class="content-section">
            <div class="section-toolbar">
                <h3 style="margin: 0;">Suivi des Couts</h3>
                <div class="toolbar-actions">
                    <select id="costsPeriod" class="filter-select">
                        <option value="current">Mois actuel</option>
                        <option value="last">Mois dernier</option>
                        <option value="year">Annee en cours</option>
                    </select>
                    <button class="btn btn-secondary" id="refreshCostsBtn">
                        <i class="fas fa-sync"></i> Actualiser
                    </button>
                </div>
            </div>

            <div class="stats-grid" style="margin-bottom: 2rem;">
                <div class="stat-card">
                    <div class="stat-content">
                        <p class="stat-label">Utilisateurs</p>
                        <h3 class="stat-value" id="costsUsers">$0.00</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-content">
                        <p class="stat-label">Equipes</p>
                        <h3 class="stat-value" id="costsTeams">$0.00</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-content">
                        <p class="stat-label">Invites</p>
                        <h3 class="stat-value" id="costsGuests">$0.00</h3>
                    </div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white;">
                    <div class="stat-content">
                        <p class="stat-label" style="color: rgba(255,255,255,0.8);">Total</p>
                        <h3 class="stat-value" id="costsTotal">$0.00</h3>
                    </div>
                </div>
            </div>

            <div class="table-container" id="costsDetails">
                <p class="loading">Chargement...</p>
            </div>
        </section>

        <!-- Users Section -->
        <section id="users" class="content-section">
            <div class="section-toolbar">
                <h3 style="margin: 0;">Gestion des Utilisateurs</h3>
                <div class="toolbar-actions">
                    <button class="btn btn-primary" id="createUserBtn">
                        <i class="fas fa-plus"></i> Creer un utilisateur
                    </button>
                </div>
            </div>
            <div class="table-container" id="usersList">
                <p class="loading">Chargement...</p>
            </div>
        </section>

        <!-- Guests Section -->
        <section id="guests" class="content-section">
            <div class="section-toolbar">
                <div class="toolbar-actions">
                    <select id="guestStatusFilter" class="filter-select">
                        <option value="">Tous les statuts</option>
                        <option value="active">Actifs</option>
                        <option value="expired">Expires</option>
                        <option value="disabled">Desactives</option>
                    </select>
                    <button class="btn btn-primary" id="createGuestBtn">
                        <i class="fas fa-user-plus"></i> Creer un invite
                    </button>
                </div>
                <div class="search-box">
                    <input type="text" id="guestSearch" placeholder="Rechercher par email...">
                </div>
            </div>

            <div class="stats-grid" style="margin-bottom: 2rem;">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-users"></i></div>
                    <div class="stat-content">
                        <p class="stat-label">Total invites</p>
                        <h3 class="stat-value" id="totalGuestsCount">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #639E30, #4A7523); color: white;"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-content">
                        <p class="stat-label">Actifs</p>
                        <h3 class="stat-value" id="activeGuestsCount">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #F8AA36, #E69A26); color: white;"><i class="fas fa-clock"></i></div>
                    <div class="stat-content">
                        <p class="stat-label">Expirent bientot</p>
                        <h3 class="stat-value" id="expiringSoonCount">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #DC2626, #B91C1C); color: white;"><i class="fas fa-ban"></i></div>
                    <div class="stat-content">
                        <p class="stat-label">Desactives</p>
                        <h3 class="stat-value" id="disabledGuestsCount">0</h3>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Cree par</th>
                            <th>Fichiers</th>
                            <th>Cree le</th>
                            <th>Expire le</th>
                            <th>Temps restant</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="guestsTableBody">
                        <tr><td colspan="8" class="loading">Chargement...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Logs Section -->
        <section id="logs" class="content-section">
            <div class="section-toolbar">
                <div class="search-box">
                    <input type="text" id="logSearchInput" placeholder="Rechercher dans les logs...">
                </div>
                <div class="toolbar-actions">
                    <select id="logLevelFilter" class="filter-select">
                        <option value="">Tous les niveaux</option>
                        <option value="info">Info</option>
                        <option value="success">Succes</option>
                        <option value="warning">Warning</option>
                        <option value="error">Erreur</option>
                    </select>
                    <select id="logCategoryFilter" class="filter-select">
                        <option value="">Toutes les categories</option>
                        <option value="file">Fichiers</option>
                        <option value="share">Partages</option>
                        <option value="domain">Domaines</option>
                        <option value="user">Utilisateurs</option>
                        <option value="auth">Authentification</option>
                        <option value="system">Systeme</option>
                    </select>
                    <button class="btn btn-secondary" id="clearLogsBtn">
                        <i class="fas fa-trash"></i> Effacer
                    </button>
                    <button class="btn btn-primary" id="exportLogsBtn">
                        <i class="fas fa-download"></i> Exporter
                    </button>
                </div>
            </div>
            <div class="table-container">
                <table class="data-table" id="logsTable">
                    <thead>
                        <tr>
                            <th style="width: 160px;">Date</th>
                            <th style="width: 90px;">Niveau</th>
                            <th style="width: 110px;">Categorie</th>
                            <th>Message</th>
                            <th style="width: 120px;">Utilisateur</th>
                        </tr>
                    </thead>
                    <tbody id="logsTableBody">
                        <tr><td colspan="5" class="loading">Chargement des logs...</td></tr>
                    </tbody>
                </table>
            </div>
            <div id="logsPagination" class="logs-pagination" style="display: none;">
                <span id="logsCount" class="logs-page-info"></span>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <button class="btn btn-secondary btn-small" id="logsPrevBtn" disabled>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span id="logsPageInfo" class="logs-page-info"></span>
                    <button class="btn btn-secondary btn-small" id="logsNextBtn" disabled>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- AI Section -->
        <section id="ai" class="content-section">
            <!-- AI Sub-tabs -->
            <div class="ai-tabs">
                <button class="ai-tab active" data-ai-tab="ai-dashboard">Dashboard</button>
                <button class="ai-tab" data-ai-tab="ai-services">Services</button>
                <button class="ai-tab" data-ai-tab="ai-params">Parametres</button>
                <button class="ai-tab" data-ai-tab="ai-scans">Scans</button>
                <button class="ai-tab" data-ai-tab="ai-map">Carte</button>
            </div>

            <!-- AI Dashboard Sub-tab -->
            <div id="ai-dashboard" class="ai-tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-image"></i></div>
                        <div class="stat-info">
                            <h3 id="aiAnalysisCount">0</h3>
                            <p>Analyses</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                        <div class="stat-info">
                            <h3 id="aiMonthlyCost">$0.00</h3>
                            <p>Cout mensuel</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-chart-pie"></i></div>
                        <div class="stat-info">
                            <h3 id="aiBudgetUsed">0%</h3>
                            <p>Budget utilise</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-spinner"></i></div>
                        <div class="stat-info">
                            <h3 id="aiQueueSize">0</h3>
                            <p>File d'attente</p>
                        </div>
                    </div>
                </div>
                <div class="stats-grid" style="margin-top: 20px;">
                    <div class="card">
                        <h3>Top Tags</h3>
                        <div id="aiTopTags" class="tag-cloud">Chargement...</div>
                    </div>
                    <div class="card">
                        <h3>Couts par service</h3>
                        <div id="aiCostByService">Chargement...</div>
                    </div>
                </div>
            </div>

            <!-- AI Services Sub-tab -->
            <div id="ai-services" class="ai-tab-content">
                <div class="settings-grid">
                    <div class="settings-card">
                        <h3><i class="fas fa-power-off"></i> Services IA</h3>
                        <div class="settings-form">
                            <div class="form-group toggle-row">
                                <label>IA globale</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="aiSvc_aiEnabled">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group toggle-row">
                                <label>OpenAI GPT-4 Vision</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="aiSvc_openaiEnabled">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group toggle-row">
                                <label>Azure AI Vision</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="aiSvc_azureVisionEnabled">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group toggle-row">
                                <label>Whisper (transcription)</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="aiSvc_transcriptionEnabled">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group toggle-row">
                                <label>Reconnaissance faciale</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="aiSvc_faceRecognitionEnabled">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group toggle-row">
                                <label>Geolocalisation</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="aiSvc_geolocationEnabled">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group toggle-row">
                                <label>Recherche semantique</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="aiSvc_searchEnabled">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group toggle-row">
                                <label>Albums intelligents</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="aiSvc_smartAlbumsEnabled">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group toggle-row">
                                <label>Timeline video</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="aiSvc_videoTimelineEnabled">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group toggle-row">
                                <label>Auto-analyse a l'upload</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="aiSvc_autoAnalyzeOnUpload">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group toggle-row">
                                <label>Reverse geocoding (Nominatim)</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="aiSvc_reverseGeocodingEnabled">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <button class="btn btn-primary" id="saveAIServicesBtn" style="margin-top: 15px;">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                    </div>
                </div>
            </div>

            <!-- AI Parameters Sub-tab -->
            <div id="ai-params" class="ai-tab-content">
                <div class="settings-grid">
                    <div class="settings-card">
                        <h3><i class="fas fa-robot"></i> Modeles</h3>
                        <div class="settings-form">
                            <div class="form-group">
                                <label>Modele OpenAI</label>
                                <select id="aiParam_openaiModel">
                                    <option value="gpt-4o">GPT-4o</option>
                                    <option value="gpt-4o-mini">GPT-4o Mini</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Modele Whisper</label>
                                <select id="aiParam_whisperModel">
                                    <option value="whisper-1">Whisper-1</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Langue transcription</label>
                                <select id="aiParam_whisperLanguage">
                                    <option value="fr">Francais</option>
                                    <option value="en">English</option>
                                    <option value="es">Espanol</option>
                                    <option value="de">Deutsch</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="settings-card">
                        <h3><i class="fas fa-sliders"></i> Seuils et parametres</h3>
                        <div class="settings-form">
                            <div class="form-group">
                                <label>Confiance faciale min (0-1)</label>
                                <input type="number" id="aiParam_faceMinConfidence" step="0.05" min="0" max="1" value="0.7">
                            </div>
                            <div class="form-group">
                                <label>Intervalle frames video (sec)</label>
                                <input type="number" id="aiParam_videoFrameInterval" min="1" max="60" value="5">
                            </div>
                            <div class="form-group">
                                <label>Taille thumbnails (px)</label>
                                <input type="number" id="aiParam_thumbnailSize" min="50" max="800" value="300">
                            </div>
                            <div class="form-group">
                                <label>Qualite thumbnails (0-100)</label>
                                <input type="number" id="aiParam_thumbnailQuality" min="10" max="100" value="80">
                            </div>
                            <div class="form-group">
                                <label>Jobs simultanes max</label>
                                <input type="number" id="aiParam_maxConcurrentAnalysis" min="1" max="10" value="3">
                            </div>
                        </div>
                    </div>
                    <div class="settings-card">
                        <h3><i class="fas fa-wallet"></i> Budget IA</h3>
                        <div class="settings-form">
                            <div class="form-group">
                                <label>Budget mensuel ($)</label>
                                <input type="number" id="aiParam_aiMonthlyBudget" min="0" max="10000" value="50">
                            </div>
                            <div class="form-group">
                                <label>Seuil alerte (% du budget)</label>
                                <input type="number" id="aiParam_aiCostAlertThreshold" min="0" max="100" value="80">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings-actions">
                    <button class="btn btn-primary btn-large" id="saveAIParamsBtn">
                        <i class="fas fa-save"></i> Enregistrer les parametres IA
                    </button>
                </div>
            </div>

            <!-- AI Scans Sub-tab -->
            <div id="ai-scans" class="ai-tab-content">
                <div class="card">
                    <h3><i class="fas fa-radar"></i> Scans planifies</h3>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Planification</th>
                                    <th>Actif</th>
                                    <th>Derniere execution</th>
                                    <th>Statut</th>
                                    <th>Fichiers traites</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="aiScansTableBody">
                                <tr><td colspan="7" class="loading">Chargement...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-secondary" id="reindexBtn">
                        <i class="fas fa-sync"></i> Reindexer la recherche
                    </button>
                </div>
            </div>

            <!-- AI Map Sub-tab -->
            <div id="ai-map" class="ai-tab-content">
                <div class="card">
                    <h3><i class="fas fa-map-marked-alt"></i> Carte des fichiers geotagues</h3>
                    <div id="ai-map-container"></div>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="content-section">
            <div class="settings-grid">
                <div class="settings-card">
                    <h3><i class="fas fa-database"></i> Configuration du Stockage</h3>
                    <div class="settings-form">
                        <div class="form-group">
                            <label>Taille maximale par fichier (MB)</label>
                            <input type="number" id="maxFileSizeMB" value="100" min="1" max="5000">
                        </div>
                        <div class="form-group">
                            <label>Nom du conteneur</label>
                            <input type="text" id="containerName" value="uploads" readonly>
                        </div>
                        <div class="form-group">
                            <label>Quota de stockage (GB)</label>
                            <input type="number" id="storageQuota" value="100" min="1" max="10000">
                        </div>
                    </div>
                </div>
                <div class="settings-card">
                    <h3><i class="fas fa-link"></i> Configuration du Partage</h3>
                    <div class="settings-form">
                        <div class="form-group">
                            <label>Duree maximale d'expiration (jours)</label>
                            <input type="number" id="maxShareDays" value="30" min="1" max="365">
                        </div>
                        <div class="form-group">
                            <label>Duree par defaut (minutes)</label>
                            <input type="number" id="defaultShareMinutes" value="60" min="15" max="43200">
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="requirePassword"> Exiger un mot de passe pour les partages</label>
                        </div>
                    </div>
                </div>
                <div class="settings-card">
                    <h3><i class="fas fa-shield-halved"></i> Securite</h3>
                    <div class="settings-form">
                        <div class="form-group">
                            <label>Rate limiting (requetes par 15 min)</label>
                            <input type="number" id="rateLimit" value="100" min="10" max="1000">
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="enableLogs" checked> Activer les logs detailles</label>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="enableAudit" checked> Activer l'audit trail</label>
                        </div>
                    </div>
                </div>
                <div class="settings-card">
                    <h3><i class="fas fa-bell"></i> Notifications</h3>
                    <div class="settings-form">
                        <div class="form-group">
                            <label><input type="checkbox" id="notifyUploads"> Notifier les nouveaux uploads</label>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="notifyShares"> Notifier les nouveaux partages</label>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="notifyQuota" checked> Alerter si quota depasse</label>
                        </div>
                    </div>
                </div>
                <div class="settings-card">
                    <h3><i class="fas fa-envelope"></i> Domaines d'emails autorises</h3>
                    <div class="settings-form">
                        <div class="form-group">
                            <label>Ajouter un domaine</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="newEmailDomainInput" class="form-input" placeholder="exemple.com" style="flex: 1;">
                                <button class="btn btn-primary" id="addEmailDomainBtn">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <div class="table-container">
                            <table class="data-table" id="emailDomainsTable">
                                <thead>
                                    <tr>
                                        <th>Domaine</th>
                                        <th>Statut</th>
                                        <th>Date d'ajout</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="emailDomainsTableBody">
                                    <tr><td colspan="4" class="loading">Chargement des domaines...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div id="emailDomainsPagination" class="domains-pagination" style="display: none;">
                            <span id="domainsCount" class="domains-page-info"></span>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <button class="btn btn-secondary btn-small" id="domainsPrevBtn" disabled>
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span id="domainsPageInfo" class="domains-page-info"></span>
                                <button class="btn btn-secondary btn-small" id="domainsNextBtn" disabled>
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="settings-actions">
                <button class="btn btn-primary btn-large" id="saveSettingsBtn">
                    <i class="fas fa-save"></i> Enregistrer les parametres
                </button>
                <button class="btn btn-secondary btn-large" id="resetSettingsBtn">
                    <i class="fas fa-undo"></i> Reinitialiser
                </button>
            </div>
        </section>
    </main>

    <!-- Modals -->

    <!-- File Details Modal -->
    <div class="modal" id="fileDetailsModal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3><i class="fas fa-file"></i> Details du fichier</h3>
                <button class="btn btn-close" id="closeFileDetailsBtn">&times;</button>
            </div>
            <div class="modal-body" id="fileDetailsBody"></div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal" style="display: none;">
        <div class="modal-content confirm-dialog">
            <div class="modal-header">
                <h3 id="confirmTitle">Confirmer l'action</h3>
            </div>
            <div class="modal-body confirm-body">
                <div class="confirm-icon">&#9888;</div>
                <p id="confirmMessage">Etes-vous sur de vouloir effectuer cette action ?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="confirmNoBtn">Annuler</button>
                <button class="btn btn-danger" id="confirmYesBtn">Confirmer</button>
            </div>
        </div>
    </div>

    <!-- Create Guest Modal -->
    <div class="modal" id="createGuestModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Creer un compte invite</h3>
                <button class="btn btn-close" id="closeCreateGuestBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createGuestForm">
                    <div class="form-group">
                        <label><i class="fas fa-envelope"></i> Email de l'invite</label>
                        <input type="email" id="guestEmail" name="email" required placeholder="invite@example.com" autocomplete="email">
                        <small style="color: var(--text-secondary);">Un code de verification sera envoye a cette adresse</small>
                    </div>
                    <div id="createGuestError" class="error-message" style="display: none; margin-top: 1rem; background: #FEE2E2; border: 1px solid #DC2626; border-radius: 8px; padding: 0.75rem;">
                        <i class="fas fa-exclamation-triangle" style="color: #DC2626;"></i>
                        <span id="createGuestErrorMessage"></span>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="submitCreateGuestBtn">
                    <i class="fas fa-paper-plane"></i> Creer et envoyer le code
                </button>
                <button class="btn btn-secondary" id="cancelCreateGuestBtn">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Guest Details Modal -->
    <div class="modal" id="guestDetailsModal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3><i class="fas fa-user-clock"></i> Details de l'invite</h3>
                <button class="btn btn-close" id="closeGuestDetailsBtn">&times;</button>
            </div>
            <div class="modal-body" id="guestDetailsBody"></div>
        </div>
    </div>

    <!-- Create Team Modal -->
    <div class="modal" id="createTeamModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-users-gear"></i> Creer une equipe</h3>
                <button class="btn btn-close" id="closeCreateTeamBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nom technique *</label>
                    <input type="text" id="teamName" placeholder="backend" required>
                    <small style="color: var(--text-secondary);">Minuscules, chiffres et tirets uniquement</small>
                </div>
                <div class="form-group">
                    <label>Nom affiche *</label>
                    <input type="text" id="teamDisplayName" placeholder="Equipe Backend" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="teamDescription" rows="3" placeholder="Description de l'equipe..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="submitCreateTeam">
                    <i class="fas fa-plus"></i> Creer
                </button>
                <button class="btn btn-secondary" id="cancelCreateTeamBtn">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Create User Modal -->
    <div class="modal" id="createUserModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Creer un utilisateur</h3>
                <button class="btn btn-close" id="closeCreateUserBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nom d'utilisateur *</label>
                    <input type="text" id="newUserUsername" placeholder="jean.dupont" required>
                </div>
                <div class="form-group">
                    <label>Nom complet</label>
                    <input type="text" id="newUserFullName" placeholder="Jean Dupont">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="newUserEmail" placeholder="jean@example.com">
                </div>
                <div class="form-group">
                    <label>Mot de passe *</label>
                    <input type="password" id="newUserPassword" placeholder="Mot de passe" required>
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select id="newUserRole" class="filter-select" style="width: 100%;">
                        <option value="user">Utilisateur</option>
                        <option value="april_user">April User (responsable)</option>
                        <option value="admin">Administrateur</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="submitCreateUser">
                    <i class="fas fa-plus"></i> Creer
                </button>
                <button class="btn btn-secondary" id="cancelCreateUserBtn">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal" id="editUserModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-edit"></i> Modifier l'utilisateur</h3>
                <button class="btn btn-close" id="closeEditUserBtn">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editUserId">
                <div class="form-group">
                    <label>Nom d'utilisateur</label>
                    <input type="text" id="editUserUsername" disabled style="opacity: 0.6;">
                </div>
                <div class="form-group">
                    <label>Nom complet</label>
                    <input type="text" id="editUserFullName" placeholder="Nom complet">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="text" id="editUserEmail" disabled style="opacity: 0.6;">
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select id="editUserRole" class="filter-select" style="width: 100%;">
                        <option value="user">Utilisateur</option>
                        <option value="april_user">April User (responsable)</option>
                        <option value="admin">Administrateur</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="submitEditUser">
                    <i class="fas fa-save"></i> Enregistrer
                </button>
                <button class="btn btn-secondary" id="cancelEditUserBtn">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div class="modal" id="resetPasswordModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Reinitialiser le mot de passe</h3>
                <button class="btn btn-close" id="closeResetPasswordBtn">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="resetPasswordUserId">
                <p style="margin-bottom: 16px; color: var(--text-secondary);">
                    Utilisateur: <strong id="resetPasswordUsername" style="color: var(--text-primary);"></strong>
                </p>
                <div class="form-group">
                    <label>Nouveau mot de passe *</label>
                    <input type="password" id="resetPasswordInput" placeholder="Nouveau mot de passe" required>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="submitResetPassword">
                    <i class="fas fa-key"></i> Reinitialiser
                </button>
                <button class="btn btn-secondary" id="cancelResetPasswordBtn">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Modal Gestion equipes d'un utilisateur -->
    <div class="modal" id="userTeamsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="userTeamsTitle">Equipes de l'utilisateur</h3>
                <button class="modal-close" id="closeUserTeamsBtn">&times;</button>
            </div>
            <div class="modal-body" id="userTeamsBody">
                <p class="loading">Chargement...</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelUserTeamsBtn">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Modal Details equipe -->
    <div class="modal" id="teamDetailModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 id="teamDetailTitle">Details equipe</h3>
                <button class="modal-close" id="closeTeamDetailBtn">&times;</button>
            </div>
            <div class="modal-body" id="teamDetailBody">
                <p class="loading">Chargement...</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelTeamDetailBtn">Fermer</button>
            </div>
        </div>
    </div>

    <script src="js/admin.js"></script>
</body>
</html>
